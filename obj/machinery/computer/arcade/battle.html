<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../../../"><link rel="stylesheet" href="dmdoc.css"><title>/obj/machinery/computer/arcade/battle - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="obj/machinery/computer/arcade/battle.html#var">Var Details</a> - <a href="obj/machinery/computer/arcade/battle.html#proc">Proc Details</a></header><main><h1>battle <aside>/<a href="obj.html">obj</a>/<a href="obj/machinery.html">machinery</a>/<a href="obj/machinery/computer.html">computer</a>/<a href="obj/machinery/computer/arcade.html">arcade</a>/<a href="obj/machinery/computer/arcade/battle.html">battle</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L40"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 40"></a></h1><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/all_worlds">all_worlds</a></th><td>List of all worlds in the game.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/battle_arcade_gear_list">battle_arcade_gear_list</a></th><td>List of all battle arcade gear that is available in the shop in game.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/bomb_cooldown">bomb_cooldown</a></th><td>unique to the emag mode, acts as a time limit where the player dies when it reaches 0.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/enemies_defeated">enemies_defeated</a></th><td>How many enemies we've defeated in a row, used to tell when we need to spawn the boss in.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/enemy_gold_reward">enemy_gold_reward</a></th><td>How much gold the enemy will drop, randomized on new opponent.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/enemy_hp">enemy_hp</a></th><td>How much HP the current enemy has.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/enemy_icon_id">enemy_icon_id</a></th><td>Determines which boss image to use on the UI.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/enemy_max_hp">enemy_max_hp</a></th><td>How much HP the current enemy has.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/enemy_mp">enemy_mp</a></th><td>How much MP the current enemy has.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/enemy_name">enemy_name</a></th><td>The enemy's name</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/equipped_gear">equipped_gear</a></th><td>Assoc list of gear the player has equipped.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/feedback_message">feedback_message</a></th><td>CURRENT ENEMY INFORMATION
A feedback message displayed in the UI during combat sequences.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/latest_unlocked_world">latest_unlocked_world</a></th><td>The latest world the player has unlocked, granting access to all worlds below this.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/player_current_hp">player_current_hp</a></th><td>The current amount of HP the player has.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/player_current_mp">player_current_mp</a></th><td>The current amount of MP the player has.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/player_current_world">player_current_world</a></th><td>The world we're currently in.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/player_gold">player_gold</a></th><td>How much money the player has, used in the Inn. Starts with the default price for a single item.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/player_turn">player_turn</a></th><td>PLAYER INFORMATION
Boolean on whether it's the player's time to do their turn.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#var/ui_panel">ui_panel</a></th><td>The current panel the player is viewieng in the UI.</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/lose_game">lose_game</a></th><td>Called when a mob loses at the battle arcade.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/on_battle_win">on_battle_win</a></th><td>on_battle_win</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/perform_enemy_turn">perform_enemy_turn</a></th><td>perform_enemy_turn</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/process_enemy_turn">process_enemy_turn</a></th><td>Handles the delay between the user's and enemy's turns to process what's going on.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/process_player_attack">process_player_attack</a></th><td>Called when you attack the enemy.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/setup_new_opponent">setup_new_opponent</a></th><td>Sets up a new opponent depending on what stage they are at.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/successful_counterattack">successful_counterattack</a></th><td>Called when you successfully counterattack the enemy.</td></tr><tr><th><a href="obj/machinery/computer/arcade/battle.html#proc/user_take_damage">user_take_damage</a></th><td>Called when the enemy attacks you.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/all_worlds"><aside class="declaration">var </aside>all_worlds <aside>– /static/list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L50"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 50"></a></h3><p>List of all worlds in the game.</p><h3 id="var/battle_arcade_gear_list"><aside class="declaration">var </aside>battle_arcade_gear_list <aside>– /static/list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L48"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 48"></a></h3><p>List of all battle arcade gear that is available in the shop in game.</p><h3 id="var/bomb_cooldown"><aside class="declaration">var </aside>bomb_cooldown <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L109"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 109"></a></h3><p>unique to the emag mode, acts as a time limit where the player dies when it reaches 0.</p><h3 id="var/enemies_defeated"><aside class="declaration">var </aside>enemies_defeated <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L72"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 72"></a></h3><p>How many enemies we've defeated in a row, used to tell when we need to spawn the boss in.</p><h3 id="var/enemy_gold_reward"><aside class="declaration">var </aside>enemy_gold_reward <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L107"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 107"></a></h3><p>How much gold the enemy will drop, randomized on new opponent.</p><h3 id="var/enemy_hp"><aside class="declaration">var </aside>enemy_hp <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L103"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 103"></a></h3><p>How much HP the current enemy has.</p><h3 id="var/enemy_icon_id"><aside class="declaration">var </aside>enemy_icon_id <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L97"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 97"></a></h3><p>Determines which boss image to use on the UI.</p><h3 id="var/enemy_max_hp"><aside class="declaration">var </aside>enemy_max_hp <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L101"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 101"></a></h3><p>How much HP the current enemy has.</p><h3 id="var/enemy_mp"><aside class="declaration">var </aside>enemy_mp <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L105"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 105"></a></h3><p>How much MP the current enemy has.</p><h3 id="var/enemy_name"><aside class="declaration">var </aside>enemy_name <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L99"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 99"></a></h3><p>The enemy's name</p><h3 id="var/equipped_gear"><aside class="declaration">var </aside>equipped_gear <aside>– /list/<a href="datum.html">datum</a>/<a href="datum/battle_arcade_gear.html">battle_arcade_gear</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L87"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 87"></a></h3><p>Assoc list of gear the player has equipped.</p><h3 id="var/feedback_message"><aside class="declaration">var </aside>feedback_message <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L95"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 95"></a></h3><p>CURRENT ENEMY INFORMATION
A feedback message displayed in the UI during combat sequences.</p><h3 id="var/latest_unlocked_world"><aside class="declaration">var </aside>latest_unlocked_world <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L70"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 70"></a></h3><p>The latest world the player has unlocked, granting access to all worlds below this.</p><h3 id="var/player_current_hp"><aside class="declaration">var </aside>player_current_hp <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L83"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 83"></a></h3><p>The current amount of HP the player has.</p><h3 id="var/player_current_mp"><aside class="declaration">var </aside>player_current_mp <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L85"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 85"></a></h3><p>The current amount of MP the player has.</p><h3 id="var/player_current_world"><aside class="declaration">var </aside>player_current_world <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L68"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 68"></a></h3><p>The world we're currently in.</p><h3 id="var/player_gold"><aside class="declaration">var </aside>player_gold <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L81"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 81"></a></h3><p>How much money the player has, used in the Inn. Starts with the default price for a single item.</p><h3 id="var/player_turn"><aside class="declaration">var </aside>player_turn <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L79"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 79"></a></h3><p>PLAYER INFORMATION
Boolean on whether it's the player's time to do their turn.</p><h3 id="var/ui_panel"><aside class="declaration">var </aside>ui_panel <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L74"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 74"></a></h3><p>The current panel the player is viewieng in the UI.</p><h2 id="proc">Proc Details</h2><h3 id="proc/lose_game"><aside class="declaration">proc </aside>lose_game<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/user)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L247"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 247"></a></aside></h3><p>Called when a mob loses at the battle arcade.</p><h3 id="proc/on_battle_win"><aside class="declaration">proc </aside>on_battle_win<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/user)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L213"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 213"></a></aside></h3><p>on_battle_win</p>
<p>Called when the player wins a level, this handles giving EXP, loot, tickets, etc.
It also handles clearing the enemy out for the next one, and unlocking new worlds.
We stop at BATTLE_WORLD_NINE because it is the last stage, and has infinite bosses.</p><h3 id="proc/perform_enemy_turn"><aside class="declaration">proc </aside>perform_enemy_turn<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/user, defending_flags)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L342"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 342"></a></aside></h3><p>perform_enemy_turn</p>
<p>Actually performs the enemy's turn.
We first roll to see if the enemy should use magic. As their HP goes lower, the chances of self healing goes higher, but
if they lack the MP, then it's rolling to steal MP from the player.
After, we will roll to see if the player counterattacks the enemy (if set), otherwise we will attack normally.</p><h3 id="proc/process_enemy_turn"><aside class="declaration">proc </aside>process_enemy_turn<aside>(/<a href="mob.html">mob</a>/user, defending_flags)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L312"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 312"></a></aside></h3><p>Handles the delay between the user's and enemy's turns to process what's going on.</p><h3 id="proc/process_player_attack"><aside class="declaration">proc </aside>process_player_attack<aside>(/<a href="mob.html">mob</a>/user, attack_type)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L275"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 275"></a></aside></h3><p>Called when you attack the enemy.</p><h3 id="proc/setup_new_opponent"><aside class="declaration">proc </aside>setup_new_opponent<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/user, enemy_gets_first_move)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L178"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 178"></a></aside></h3><p>Sets up a new opponent depending on what stage they are at.</p><h3 id="proc/successful_counterattack"><aside class="declaration">proc </aside>successful_counterattack<aside>(/<a href="mob.html">mob</a>/user)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L301"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 301"></a></aside></h3><p>Called when you successfully counterattack the enemy.</p><h3 id="proc/user_take_damage"><aside class="declaration">proc </aside>user_take_damage<aside>(/<a href="mob.html">mob</a>/user, base_damage_taken)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/game/machinery/computer/arcade/battle.dm#L258"><img src="git.png" width="16" height="16" title="code/game/machinery/computer/arcade/battle.dm 258"></a></aside></h3><p>Called when the enemy attacks you.</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f">cd8d3cf</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>