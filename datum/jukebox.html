<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/jukebox - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/jukebox.html#var">Var Details</a> - <a href="datum/jukebox.html#proc">Proc Details</a></header><main><h1>jukebox <aside>/<a href="datum.html">datum</a>/<a href="datum/jukebox.html">jukebox</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L14"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 14"></a></h1><h2 id="jukebox-datum">Jukebox datum</h2>
<p>Plays music to nearby mobs when hosted in a movable or a turf.</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/jukebox.html#var/active_song_sound">active_song_sound</a></th><td>Current song datum playing</td></tr><tr><th><a href="datum/jukebox.html#var/listeners">listeners</a></th><td>Assoc list of all mobs listening to the jukebox to their sound status.</td></tr><tr><th><a href="datum/jukebox.html#var/parent">parent</a></th><td>Atom that hosts the jukebox. Can be a turf or a movable.</td></tr><tr><th><a href="datum/jukebox.html#var/requires_range_check">requires_range_check</a></th><td>Whether the jukebox requires a connect_range component to check for new listeners</td></tr><tr><th><a href="datum/jukebox.html#var/selection">selection</a></th><td>Current song track selected</td></tr><tr><th><a href="datum/jukebox.html#var/songs">songs</a></th><td>List of /datum/tracks we can play. Set via get_songs().</td></tr><tr><th><a href="datum/jukebox.html#var/sound_loops">sound_loops</a></th><td>Whether the music loops when done.
If FALSE, you must handle ending music yourself.</td></tr><tr><th><a href="datum/jukebox.html#var/sound_range">sound_range</a></th><td>Range at which the sound plays to players, can also be a view &quot;XxY&quot; string</td></tr><tr><th><a href="datum/jukebox.html#var/volume">volume</a></th><td>Volume of the songs played. Also serves as the max volume.
Do not set directly, use set_new_volume() instead.</td></tr><tr><th><a href="datum/jukebox.html#var/x_cutoff">x_cutoff</a></th><td>How far away horizontally from the jukebox can you be before you stop hearing it</td></tr><tr><th><a href="datum/jukebox.html#var/z_cutoff">z_cutoff</a></th><td>How far away vertically from the jukebox can you be before you stop hearing it</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/jukebox.html#proc/check_new_listener">check_new_listener</a></th><td>Check for new mobs entering the jukebox's range.</td></tr><tr><th><a href="datum/jukebox.html#proc/deregister_listener">deregister_listener</a></th><td>Deregisters the passed mob as a listener to the jukebox, stopping the music.</td></tr><tr><th><a href="datum/jukebox.html#proc/get_active_listeners">get_active_listeners</a></th><td>Helper to get all mobs currently, ACTIVELY listening to the jukebox.</td></tr><tr><th><a href="datum/jukebox.html#proc/get_ui_data">get_ui_data</a></th><td>Returns a set of general data relating to the jukebox for use in TGUI.</td></tr><tr><th><a href="datum/jukebox.html#proc/init_songs">init_songs</a></th><td>Initializes the track list.</td></tr><tr><th><a href="datum/jukebox.html#proc/listener_deaf">listener_deaf</a></th><td>Updates the sound's mute status when the mob's deafness updates.</td></tr><tr><th><a href="datum/jukebox.html#proc/listener_deleted">listener_deleted</a></th><td>Deregisters mobs on deletion.</td></tr><tr><th><a href="datum/jukebox.html#proc/listener_login">listener_login</a></th><td>Allows mobs who are clientless when the music starts to hear it when they log in.</td></tr><tr><th><a href="datum/jukebox.html#proc/listener_moved">listener_moved</a></th><td>Updates the sound's position on mob movement.</td></tr><tr><th><a href="datum/jukebox.html#proc/load_songs_from_config">load_songs_from_config</a></th><td>Loads the config sounds once, and returns a copy of them.</td></tr><tr><th><a href="datum/jukebox.html#proc/on_enter_area">on_enter_area</a></th><td>When the jukebox enters a new area entirely, we need to update the environment to the new area's.</td></tr><tr><th><a href="datum/jukebox.html#proc/on_moved">on_moved</a></th><td>When the jukebox moves, we need to update all listeners.</td></tr><tr><th><a href="datum/jukebox.html#proc/parent_delete">parent_delete</a></th><td>When our parent is deleted, we should go too.</td></tr><tr><th><a href="datum/jukebox.html#proc/register_listener">register_listener</a></th><td>Registers the passed mob as a new listener to the jukebox.</td></tr><tr><th><a href="datum/jukebox.html#proc/set_new_environment">set_new_environment</a></th><td>Sets the sound's environment to a new value.
Then updates any mobs listening to it.</td></tr><tr><th><a href="datum/jukebox.html#proc/set_new_volume">set_new_volume</a></th><td>Sets the sound's volume to a new value.
Then updates any mobs listening to it.</td></tr><tr><th><a href="datum/jukebox.html#proc/set_sound_range">set_sound_range</a></th><td>Sets the sound's range to a new value. This can be a number or a view size string &quot;XxY&quot;.
Then updates any mobs listening to it.</td></tr><tr><th><a href="datum/jukebox.html#proc/set_volume_to_max">set_volume_to_max</a></th><td>Sets volume to the maximum possible value, the initial volume value.</td></tr><tr><th><a href="datum/jukebox.html#proc/start_music">start_music</a></th><td>Helper to kickstart the music for all mobs in hearing range of the jukebox.</td></tr><tr><th><a href="datum/jukebox.html#proc/unlisten_all">unlisten_all</a></th><td>Helper to stop the music for all mobs listening to the music.</td></tr><tr><th><a href="datum/jukebox.html#proc/unmute_listener">unmute_listener</a></th><td>Unmutes the passed mob's sound from the passed reason.</td></tr><tr><th><a href="datum/jukebox.html#proc/update_all">update_all</a></th><td>Helper to update all mobs currently listening to the music.</td></tr><tr><th><a href="datum/jukebox.html#proc/update_listener">update_listener</a></th><td>Updates the passed mob's sound in according to their position and status.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/active_song_sound"><aside class="declaration">var </aside>active_song_sound <aside>– /final/sound</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L22"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 22"></a></h3><p>Current song datum playing</p><h3 id="var/listeners"><aside class="declaration">var </aside>listeners <aside>– /list/<a href="mob.html">mob</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L27"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 27"></a></h3><p>Assoc list of all mobs listening to the jukebox to their sound status.</p><h3 id="var/parent"><aside class="declaration">var </aside>parent <aside>– /final/<a href="atom.html">atom</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L16"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 16"></a></h3><p>Atom that hosts the jukebox. Can be a turf or a movable.</p><h3 id="var/requires_range_check"><aside class="declaration">var </aside>requires_range_check <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L24"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 24"></a></h3><p>Whether the jukebox requires a connect_range component to check for new listeners</p><h3 id="var/selection"><aside class="declaration">var </aside>selection <aside>– /final/<a href="datum.html">datum</a>/<a href="datum/track.html">track</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L20"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 20"></a></h3><p>Current song track selected</p><h3 id="var/songs"><aside class="declaration">var </aside>songs <aside>– /final/list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L18"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 18"></a></h3><p>List of /datum/tracks we can play. Set via get_songs().</p><h3 id="var/sound_loops"><aside class="declaration">var </aside>sound_loops <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L41"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 41"></a></h3><p>Whether the music loops when done.
If FALSE, you must handle ending music yourself.</p><h3 id="var/sound_range"><aside class="declaration">var </aside>sound_range <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L34"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 34"></a></h3><p>Range at which the sound plays to players, can also be a view &quot;XxY&quot; string</p><h3 id="var/volume"><aside class="declaration">var </aside>volume <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L31"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 31"></a></h3><p>Volume of the songs played. Also serves as the max volume.
Do not set directly, use set_new_volume() instead.</p><h3 id="var/x_cutoff"><aside class="declaration">var </aside>x_cutoff <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L36"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 36"></a></h3><p>How far away horizontally from the jukebox can you be before you stop hearing it</p><h3 id="var/z_cutoff"><aside class="declaration">var </aside>z_cutoff <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L38"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 38"></a></h3><p>How far away vertically from the jukebox can you be before you stop hearing it</p><h2 id="proc">Proc Details</h2><h3 id="proc/check_new_listener"><aside class="declaration">proc </aside>check_new_listener<aside>(/<a href="datum.html">datum</a>/source, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/entered)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L376"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 376"></a></aside></h3><p>Check for new mobs entering the jukebox's range.</p><h3 id="proc/deregister_listener"><aside class="declaration">proc </aside>deregister_listener<aside>(/<a href="mob.html">mob</a>/no_longer_listening)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L313"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 313"></a></aside></h3><p>Deregisters the passed mob as a listener to the jukebox, stopping the music.</p><h3 id="proc/get_active_listeners"><aside class="declaration">proc </aside>get_active_listeners<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L209"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 209"></a></aside></h3><p>Helper to get all mobs currently, ACTIVELY listening to the jukebox.</p><h3 id="proc/get_ui_data"><aside class="declaration">proc </aside>get_ui_data<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L133"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 133"></a></aside></h3><p>Returns a set of general data relating to the jukebox for use in TGUI.</p>
<p>Returns</p>
<ul>
<li>A list of UI data</li>
</ul><h3 id="proc/init_songs"><aside class="declaration">proc </aside>init_songs<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L90"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 90"></a></aside></h3><p>Initializes the track list.</p>
<p>By default, this loads all tracks from the config datum.</p>
<p>Returns</p>
<ul>
<li>An assoc list of track names to /datum/track. Track names must be unique.</li>
</ul><h3 id="proc/listener_deaf"><aside class="declaration">proc </aside>listener_deaf<aside>(/<a href="mob.html">mob</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L270"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 270"></a></aside></h3><p>Updates the sound's mute status when the mob's deafness updates.</p><h3 id="proc/listener_deleted"><aside class="declaration">proc </aside>listener_deleted<aside>(/<a href="mob.html">mob</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L254"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 254"></a></aside></h3><p>Deregisters mobs on deletion.</p><h3 id="proc/listener_login"><aside class="declaration">proc </aside>listener_login<aside>(/<a href="mob.html">mob</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L264"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 264"></a></aside></h3><p>Allows mobs who are clientless when the music starts to hear it when they log in.</p><h3 id="proc/listener_moved"><aside class="declaration">proc </aside>listener_moved<aside>(/<a href="mob.html">mob</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L259"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 259"></a></aside></h3><p>Updates the sound's position on mob movement.</p><h3 id="proc/load_songs_from_config"><aside class="declaration">proc </aside>load_songs_from_config<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L94"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 94"></a></aside></h3><p>Loads the config sounds once, and returns a copy of them.</p><h3 id="proc/on_enter_area"><aside class="declaration">proc </aside>on_enter_area<aside>(/<a href="datum.html">datum</a>/source, /<a href="area.html">area</a>/area_to_register)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L371"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 371"></a></aside></h3><p>When the jukebox enters a new area entirely, we need to update the environment to the new area's.</p><h3 id="proc/on_moved"><aside class="declaration">proc </aside>on_moved<aside>(/<a href="datum.html">datum</a>/source, ...)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L366"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 366"></a></aside></h3><p>When the jukebox moves, we need to update all listeners.</p><h3 id="proc/parent_delete"><aside class="declaration">proc </aside>parent_delete<aside>(/<a href="datum.html">datum</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L78"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 78"></a></aside></h3><p>When our parent is deleted, we should go too.</p><h3 id="proc/register_listener"><aside class="declaration">proc </aside>register_listener<aside>(/<a href="mob.html">mob</a>/new_listener)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L218"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 218"></a></aside></h3><p>Registers the passed mob as a new listener to the jukebox.</p><h3 id="proc/set_new_environment"><aside class="declaration">proc </aside>set_new_environment<aside>(new_env)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L186"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 186"></a></aside></h3><p>Sets the sound's environment to a new value.
Then updates any mobs listening to it.</p><h3 id="proc/set_new_volume"><aside class="declaration">proc </aside>set_new_volume<aside>(new_vol)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L168"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 168"></a></aside></h3><p>Sets the sound's volume to a new value.
Then updates any mobs listening to it.</p><h3 id="proc/set_sound_range"><aside class="declaration">proc </aside>set_sound_range<aside>(new_range)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L155"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 155"></a></aside></h3><p>Sets the sound's range to a new value. This can be a number or a view size string &quot;XxY&quot;.
Then updates any mobs listening to it.</p><h3 id="proc/set_volume_to_max"><aside class="declaration">proc </aside>set_volume_to_max<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L179"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 179"></a></aside></h3><p>Sets volume to the maximum possible value, the initial volume value.</p><h3 id="proc/start_music"><aside class="declaration">proc </aside>start_music<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L204"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 204"></a></aside></h3><p>Helper to kickstart the music for all mobs in hearing range of the jukebox.</p><h3 id="proc/unlisten_all"><aside class="declaration">proc </aside>unlisten_all<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L193"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 193"></a></aside></h3><p>Helper to stop the music for all mobs listening to the music.</p><h3 id="proc/unmute_listener"><aside class="declaration">proc </aside>unmute_listener<aside>(/<a href="mob.html">mob</a>/listener, reason)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L286"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 286"></a></aside></h3><p>Unmutes the passed mob's sound from the passed reason.</p>
<p>Arguments</p>
<ul>
<li>mob/listener - The mob to unmute.</li>
<li>reason - The reason to unmute them for. Can be a combination of MUTE_DEAF, MUTE_PREF, MUTE_RANGE.</li>
</ul><h3 id="proc/update_all"><aside class="declaration">proc </aside>update_all<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L199"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 199"></a></aside></h3><p>Helper to update all mobs currently listening to the music.</p><h3 id="proc/update_listener"><aside class="declaration">proc </aside>update_listener<aside>(/<a href="mob.html">mob</a>/listener)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/jukebox.dm#L328"><img src="git.png" width="16" height="16" title="code/datums/components/jukebox.dm 328"></a></aside></h3><p>Updates the passed mob's sound in according to their position and status.</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f">cd8d3cf</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>