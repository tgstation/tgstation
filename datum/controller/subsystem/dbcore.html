<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/controller/subsystem/dbcore - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/controller/subsystem/dbcore.html#var">Var Details</a> - <a href="datum/controller/subsystem/dbcore.html#proc">Proc Details</a></header><main><h1>dbcore <aside>/<a href="datum.html">datum</a>/<a href="datum/controller/subsystem.html">controller/subsystem</a>/<a href="datum/controller/subsystem/dbcore.html">dbcore</a></aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L2"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 2"></a></h1><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/all_queries">all_queries</a></th><td>All the current queries that exist.</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/all_queries_num">all_queries_num</a></th><td>Number of all queries, reset to 0 when logged in SStime_track. Used by SStime_track</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/failed_connection_timeout">failed_connection_timeout</a></th><td>world.time that connection attempts can resume</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/failed_connection_timeout_count">failed_connection_timeout_count</a></th><td>Total number of times connections have had to be timed out.</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/failed_connections">failed_connections</a></th><td>Number of failed connection attempts this try. Resets after the timeout or successful connection</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/max_connection_failures">max_connection_failures</a></th><td>Max number of consecutive failures before a timeout (here and not a define so it can be vv'ed mid round if needed)</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/processing_queries">processing_queries</a></th><td>Queries being checked for timeouts.</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/queries_active">queries_active</a></th><td>Queries currently being handled by database driver</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/queries_active_num">queries_active_num</a></th><td>Number of active queries, reset to 0 when logged in SStime_track. Used by SStime_track</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/queries_standby">queries_standby</a></th><td>Queries pending execution, mapped to complete arguments</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/queries_standby_num">queries_standby_num</a></th><td>Number of standby queries, reset to 0 when logged in SStime_track. Used by SStime_track</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#var/shutting_down">shutting_down</a></th><td>We are in the process of shutting down and should not allow more DB connections</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#proc/FireAndForget">FireAndForget</a></th><td>Creates and executes a query without waiting for or tracking the results.
Query is executed asynchronously (without blocking) and deleted afterwards - any results or errors are discarded.</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#proc/QuerySelect">QuerySelect</a></th><td></td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#proc/create_active_query">create_active_query</a></th><td>Helper proc for handling activating queued queries</td></tr><tr><th><a href="datum/controller/subsystem/dbcore.html#proc/reset_tracking">reset_tracking</a></th><td>Resets the tracking numbers on the subsystem. Used by SStime_track.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/all_queries"><aside class="declaration">var </aside>all_queries <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L34"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 34"></a></h3><p>All the current queries that exist.</p><h3 id="var/all_queries_num"><aside class="declaration">var </aside>all_queries_num <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L27"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 27"></a></h3><p>Number of all queries, reset to 0 when logged in SStime_track. Used by SStime_track</p><h3 id="var/failed_connection_timeout"><aside class="declaration">var </aside>failed_connection_timeout <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L18"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 18"></a></h3><p>world.time that connection attempts can resume</p><h3 id="var/failed_connection_timeout_count"><aside class="declaration">var </aside>failed_connection_timeout_count <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L20"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 20"></a></h3><p>Total number of times connections have had to be timed out.</p><h3 id="var/failed_connections"><aside class="declaration">var </aside>failed_connections <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L14"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 14"></a></h3><p>Number of failed connection attempts this try. Resets after the timeout or successful connection</p><h3 id="var/max_connection_failures"><aside class="declaration">var </aside>max_connection_failures <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L16"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 16"></a></h3><p>Max number of consecutive failures before a timeout (here and not a define so it can be vv'ed mid round if needed)</p><h3 id="var/processing_queries"><aside class="declaration">var </aside>processing_queries <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L36"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 36"></a></h3><p>Queries being checked for timeouts.</p><h3 id="var/queries_active"><aside class="declaration">var </aside>queries_active <aside>– /list/<a href="datum.html">datum</a>/<a href="datum/db_query.html">db_query</a></aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L39"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 39"></a></h3><p>Queries currently being handled by database driver</p><h3 id="var/queries_active_num"><aside class="declaration">var </aside>queries_active_num <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L29"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 29"></a></h3><p>Number of active queries, reset to 0 when logged in SStime_track. Used by SStime_track</p><h3 id="var/queries_standby"><aside class="declaration">var </aside>queries_standby <aside>– /list/<a href="datum.html">datum</a>/<a href="datum/db_query.html">db_query</a></aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L41"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 41"></a></h3><p>Queries pending execution, mapped to complete arguments</p><h3 id="var/queries_standby_num"><aside class="declaration">var </aside>queries_standby_num <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L31"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 31"></a></h3><p>Number of standby queries, reset to 0 when logged in SStime_track. Used by SStime_track</p><h3 id="var/shutting_down"><aside class="declaration">var </aside>shutting_down <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L44"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 44"></a></h3><p>We are in the process of shutting down and should not allow more DB connections</p><h2 id="proc">Proc Details</h2><h3 id="proc/FireAndForget"><aside class="declaration">proc </aside>FireAndForget<aside>(sql_query, arguments, allow_during_shutdown)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L398"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 398"></a></aside></h3><p>Creates and executes a query without waiting for or tracking the results.
Query is executed asynchronously (without blocking) and deleted afterwards - any results or errors are discarded.</p>
<p>Arguments:</p>
<ul>
<li>sql_query - The SQL query string to execute</li>
<li>arguments - List of arguments to pass to the query for parameter binding</li>
<li>allow_during_shutdown - If TRUE, allows query to be created during subsystem shutdown. Generally, only cleanup queries should set this.</li>
</ul><h3 id="proc/QuerySelect"><aside class="declaration">proc </aside>QuerySelect<aside>(/list/queries, warn, qdel)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L414"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 414"></a></aside></h3><ul>
<li>QuerySelect
Run a list of query datums in parallel, blocking until they all complete.
<ul>
<li>queries - List of queries or single query datum to run.</li>
<li>warn - Controls rather warn_execute() or Execute() is called.</li>
<li>qdel - If you don't care about the result or checking for errors, you can have the queries be deleted afterwards.
This can be combined with invoke_async as a way of running queries async without having to care about waiting for them to finish so they can be deleted,
however you should probably just use FireAndForget instead if it's just a single query.</li>
</ul>
</li>
</ul><h3 id="proc/create_active_query"><aside class="declaration">proc </aside>create_active_query<aside>(/<a href="datum.html">datum</a>/<a href="datum/db_query.html">db_query</a>/query)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L135"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 135"></a></aside></h3><p>Helper proc for handling activating queued queries</p><h3 id="proc/reset_tracking"><aside class="declaration">proc </aside>reset_tracking<aside>()  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/controllers/subsystem/dbcore.dm#L95"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/dbcore.dm 95"></a></aside></h3><p>Resets the tracking numbers on the subsystem. Used by SStime_track.</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/c41b333c9bc46606d2c5d5b517f7836d5953fbfd">c41b333</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>