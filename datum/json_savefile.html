<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/json_savefile - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/json_savefile.html#var">Var Details</a> - <a href="datum/json_savefile.html#proc">Proc Details</a></header><main><h1>json_savefile <aside>/<a href="datum.html">datum</a>/<a href="datum/json_savefile.html">json_savefile</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L6"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 6"></a></h1><p>A savefile implementation that handles all data using json.
Also saves it using JSON too, fancy.
If you pass in a null path, it simply acts as a memory tree instead, and cannot be saved.</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/json_savefile.html#var/auto_save">auto_save</a></th><td>If this is set to true, calling set_entry or remove_entry will automatically call save(), this does not catch modifying a sub-tree, nor do I know how to do that</td></tr><tr><th><a href="datum/json_savefile.html#var/download_cooldown">download_cooldown</a></th><td>Cooldown that tracks the time between attempts to download the savefile.</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/json_savefile.html#proc/copy_to_savefile">copy_to_savefile</a></th><td>Copies the entire tree to another json savefile datum, overwriting whatever was in the other datum before.</td></tr><tr><th><a href="datum/json_savefile.html#proc/export_json_to_client">export_json_to_client</a></th><td>Proc that handles generating a JSON file (prettified if 515 and over!) of a user's preferences and showing it to them.
Requester is passed in to the ftp() and tgui_alert() procs, and account_name is just used to generate the filename.
We don't <em>need</em> to pass in account_name since this is reliant on the json_savefile datum already knowing what we correspond to, but it's here to help people keep track of their stuff.</td></tr><tr><th><a href="datum/json_savefile.html#proc/get_entry">get_entry</a></th><td>Gets an entry from the json tree, with an optional default value.
If no key is specified it throws the entire tree at you instead</td></tr><tr><th><a href="datum/json_savefile.html#proc/import_byond_savefile">import_byond_savefile</a></th><td>Traverses the entire dir tree of the given savefile and dynamically assembles the tree from it</td></tr><tr><th><a href="datum/json_savefile.html#proc/json_export_checks">json_export_checks</a></th><td>Proc that just handles all of the checks for exporting a preferences file, returns TRUE if all checks are passed, FALSE otherwise.
Just done like this to make the code in the export_json_to_client() proc a bit cleaner.</td></tr><tr><th><a href="datum/json_savefile.html#proc/remove_entry">remove_entry</a></th><td>Removes the given key from the tree</td></tr><tr><th><a href="datum/json_savefile.html#proc/set_entry">set_entry</a></th><td>Sets an entry in the tree to the given value</td></tr><tr><th><a href="datum/json_savefile.html#proc/wipe">wipe</a></th><td>Wipes the entire tree</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/auto_save"><aside class="declaration">var </aside>auto_save <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L10"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 10"></a></h3><p>If this is set to true, calling set_entry or remove_entry will automatically call save(), this does not catch modifying a sub-tree, nor do I know how to do that</p><h3 id="var/download_cooldown"><aside class="declaration">var </aside>download_cooldown <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L12"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 12"></a></h3><p>Cooldown that tracks the time between attempts to download the savefile.</p><h2 id="proc">Proc Details</h2><h3 id="proc/copy_to_savefile"><aside class="declaration">proc </aside>copy_to_savefile<aside>(/<a href="datum.html">datum</a>/<a href="datum/json_savefile.html">json_savefile</a>/other_savefile)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L123"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 123"></a></aside></h3><p>Copies the entire tree to another json savefile datum, overwriting whatever was in the other datum before.</p><h3 id="proc/export_json_to_client"><aside class="declaration">proc </aside>export_json_to_client<aside>(/<a href="mob.html">mob</a>/requester, account_name)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L90"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 90"></a></aside></h3><p>Proc that handles generating a JSON file (prettified if 515 and over!) of a user's preferences and showing it to them.
Requester is passed in to the ftp() and tgui_alert() procs, and account_name is just used to generate the filename.
We don't <em>need</em> to pass in account_name since this is reliant on the json_savefile datum already knowing what we correspond to, but it's here to help people keep track of their stuff.</p><h3 id="proc/get_entry"><aside class="declaration">proc </aside>get_entry<aside>(key, default_value)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L26"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 26"></a></aside></h3><p>Gets an entry from the json tree, with an optional default value.
If no key is specified it throws the entire tree at you instead</p><h3 id="proc/import_byond_savefile"><aside class="declaration">proc </aside>import_byond_savefile<aside>(/savefile/savefile)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L68"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 68"></a></aside></h3><p>Traverses the entire dir tree of the given savefile and dynamically assembles the tree from it</p><h3 id="proc/json_export_checks"><aside class="declaration">proc </aside>json_export_checks<aside>(/<a href="mob.html">mob</a>/requester)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L112"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 112"></a></aside></h3><p>Proc that just handles all of the checks for exporting a preferences file, returns TRUE if all checks are passed, FALSE otherwise.
Just done like this to make the code in the export_json_to_client() proc a bit cleaner.</p><h3 id="proc/remove_entry"><aside class="declaration">proc </aside>remove_entry<aside>(key)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L38"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 38"></a></aside></h3><p>Removes the given key from the tree</p><h3 id="proc/set_entry"><aside class="declaration">proc </aside>set_entry<aside>(key, value)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L32"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 32"></a></aside></h3><p>Sets an entry in the tree to the given value</p><h3 id="proc/wipe"><aside class="declaration">proc </aside>wipe<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/json_savefile.dm#L45"><img src="git.png" width="16" height="16" title="code/datums/json_savefile.dm 45"></a></aside></h3><p>Wipes the entire tree</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f">cd8d3cf</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>