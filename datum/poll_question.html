<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/poll_question - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/poll_question.html#var">Var Details</a> - <a href="datum/poll_question.html#proc">Proc Details</a></header><main><h1>poll_question <aside>/<a href="datum.html">datum</a>/<a href="datum/poll_question.html">poll_question</a></aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L7"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 7"></a></h1><p>Datum which holds details of a running poll loaded from the database and supplementary info.</p>
<p>Used to minimize the need for querying this data every time it's needed.</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/poll_question.html#var/admin_only">admin_only</a></th><td>Hides the poll from any client without a holder datum.</td></tr><tr><th><a href="datum/poll_question.html#var/allow_revoting">allow_revoting</a></th><td>Allows a player to change their vote to a poll they've already voted on, off by default.</td></tr><tr><th><a href="datum/poll_question.html#var/created_by">created_by</a></th><td>Ckey of the poll's original author</td></tr><tr><th><a href="datum/poll_question.html#var/dont_show">dont_show</a></th><td>Hint for statbus, not used by the game; Stops the results of a poll from being displayed until the end_datetime is reached.</td></tr><tr><th><a href="datum/poll_question.html#var/duration">duration</a></th><td>Holds duration data when creating or editing a poll and refreshing the poll creation window.</td></tr><tr><th><a href="datum/poll_question.html#var/edit_ready">edit_ready</a></th><td>Indicates if a poll has been submitted or loaded from the DB so the management panel will open with edit functions.</td></tr><tr><th><a href="datum/poll_question.html#var/end_datetime">end_datetime</a></th><td>Date and time the poll will run until, timestamp format is YYYY-MM-DD HH:MM:SS.</td></tr><tr><th><a href="datum/poll_question.html#var/future_poll">future_poll</a></th><td>Indicates a poll is set to not start in the future, still visible for editing but not voting on.</td></tr><tr><th><a href="datum/poll_question.html#var/interval">interval</a></th><td>Holds interval data when creating or editing a poll and refreshing the poll creation window.</td></tr><tr><th><a href="datum/poll_question.html#var/options">options</a></th><td>Reference list of the options for this poll, not used by text response polls.</td></tr><tr><th><a href="datum/poll_question.html#var/options_allowed">options_allowed</a></th><td>The number of responses allowed in a multiple-choice poll, more can be selected but won't be recorded.</td></tr><tr><th><a href="datum/poll_question.html#var/poll_id">poll_id</a></th><td>Table id of this poll, will be null until poll has been created.</td></tr><tr><th><a href="datum/poll_question.html#var/poll_type">poll_type</a></th><td>The type of poll to be created, must be POLLTYPE_OPTION, POLLTYPE_TEXT, POLLTYPE_RATING, POLLTYPE_MULTI or POLLTYPE_IRV.</td></tr><tr><th><a href="datum/poll_question.html#var/poll_votes">poll_votes</a></th><td>Count of how many players have voted or responded to this poll.</td></tr><tr><th><a href="datum/poll_question.html#var/question">question</a></th><td>The title text of the poll, shows up on the list of polls.</td></tr><tr><th><a href="datum/poll_question.html#var/start_datetime">start_datetime</a></th><td>Date and time the poll opens, timestamp format is YYYY-MM-DD HH:MM:SS.</td></tr><tr><th><a href="datum/poll_question.html#var/subtitle">subtitle</a></th><td>Supplementary text displayed only when responding to a poll.</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/poll_question.html#proc/clear_poll_votes">clear_poll_votes</a></th><td>Deletes all votes or text replies for this poll, depending on its type.</td></tr><tr><th><a href="datum/poll_question.html#proc/delete_poll">delete_poll</a></th><td>Sets a poll and its associated data as deleted in the database.</td></tr><tr><th><a href="datum/poll_question.html#proc/save_all_options">save_all_options</a></th><td>Saves all options of a poll to the database.</td></tr><tr><th><a href="datum/poll_question.html#proc/save_poll_data">save_poll_data</a></th><td>Inserts or updates a poll question to the database.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/admin_only"><aside class="declaration">var </aside>admin_only <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L27"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 27"></a></h3><p>Hides the poll from any client without a holder datum.</p><h3 id="var/allow_revoting"><aside class="declaration">var </aside>allow_revoting <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L33"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 33"></a></h3><p>Allows a player to change their vote to a poll they've already voted on, off by default.</p><h3 id="var/created_by"><aside class="declaration">var </aside>created_by <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L17"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 17"></a></h3><p>Ckey of the poll's original author</p><h3 id="var/dont_show"><aside class="declaration">var </aside>dont_show <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L31"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 31"></a></h3><p>Hint for statbus, not used by the game; Stops the results of a poll from being displayed until the end_datetime is reached.</p><h3 id="var/duration"><aside class="declaration">var </aside>duration <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L37"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 37"></a></h3><p>Holds duration data when creating or editing a poll and refreshing the poll creation window.</p><h3 id="var/edit_ready"><aside class="declaration">var </aside>edit_ready <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L35"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 35"></a></h3><p>Indicates if a poll has been submitted or loaded from the DB so the management panel will open with edit functions.</p><h3 id="var/end_datetime"><aside class="declaration">var </aside>end_datetime <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L21"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 21"></a></h3><p>Date and time the poll will run until, timestamp format is YYYY-MM-DD HH:MM:SS.</p><h3 id="var/future_poll"><aside class="declaration">var </aside>future_poll <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L41"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 41"></a></h3><p>Indicates a poll is set to not start in the future, still visible for editing but not voting on.</p><h3 id="var/interval"><aside class="declaration">var </aside>interval <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L39"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 39"></a></h3><p>Holds interval data when creating or editing a poll and refreshing the poll creation window.</p><h3 id="var/options"><aside class="declaration">var </aside>options <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L9"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 9"></a></h3><p>Reference list of the options for this poll, not used by text response polls.</p><h3 id="var/options_allowed"><aside class="declaration">var </aside>options_allowed <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L29"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 29"></a></h3><p>The number of responses allowed in a multiple-choice poll, more can be selected but won't be recorded.</p><h3 id="var/poll_id"><aside class="declaration">var </aside>poll_id <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L11"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 11"></a></h3><p>Table id of this poll, will be null until poll has been created.</p><h3 id="var/poll_type"><aside class="declaration">var </aside>poll_type <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L13"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 13"></a></h3><p>The type of poll to be created, must be POLLTYPE_OPTION, POLLTYPE_TEXT, POLLTYPE_RATING, POLLTYPE_MULTI or POLLTYPE_IRV.</p><h3 id="var/poll_votes"><aside class="declaration">var </aside>poll_votes <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L15"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 15"></a></h3><p>Count of how many players have voted or responded to this poll.</p><h3 id="var/question"><aside class="declaration">var </aside>question <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L23"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 23"></a></h3><p>The title text of the poll, shows up on the list of polls.</p><h3 id="var/start_datetime"><aside class="declaration">var </aside>start_datetime <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L19"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 19"></a></h3><p>Date and time the poll opens, timestamp format is YYYY-MM-DD HH:MM:SS.</p><h3 id="var/subtitle"><aside class="declaration">var </aside>subtitle <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L25"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 25"></a></h3><p>Supplementary text displayed only when responding to a poll.</p><h2 id="proc">Proc Details</h2><h3 id="proc/clear_poll_votes"><aside class="declaration">proc </aside>clear_poll_votes<aside>()  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L459"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 459"></a></aside></h3><p>Deletes all votes or text replies for this poll, depending on its type.</p><h3 id="proc/delete_poll"><aside class="declaration">proc </aside>delete_poll<aside>()  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L353"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 353"></a></aside></h3><p>Sets a poll and its associated data as deleted in the database.</p>
<p>Calls the procedure set_poll_deleted to set the deleted column to 1 for each row in the poll_ tables matching the poll id used.
Then deletes each option datum and finally the poll itself.</p><h3 id="proc/save_all_options"><aside class="declaration">proc </aside>save_all_options<aside>()  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L447"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 447"></a></aside></h3><p>Saves all options of a poll to the database.</p>
<p>Saves all the created options for a poll when it's submitted to the DB for the first time and associated an id with the options.
Insertion and id querying for each option is done separately to ensure data integrity; this is less performant, but not significantly.
Using MassInsert() would mean having to query a list of rows by poll_id or matching by fields afterwards, which doesn't guarantee accuracy.</p><h3 id="proc/save_poll_data"><aside class="declaration">proc </aside>save_poll_data<aside>(clear_votes)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/modules/admin/poll_management.dm#L382"><img src="git.png" width="16" height="16" title="code/modules/admin/poll_management.dm 382"></a></aside></h3><p>Inserts or updates a poll question to the database.</p>
<p>Uses INSERT ON DUPLICATE KEY UPDATE to handle both inserting and updating at once.
The start and end datetimes and poll id for new polls is then retrieved for the poll datum.
Arguments:</p>
<ul>
<li>clear_votes - When true will call clear_poll_votes() to delete all votes matching this poll id.</li>
</ul></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/c41b333c9bc46606d2c5d5b517f7836d5953fbfd">c41b333</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>