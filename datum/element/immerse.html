<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/element/immerse - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/element/immerse.html#var">Var Details</a> - <a href="datum/element/immerse.html#proc">Proc Details</a></header><main><h1>immerse <aside>/<a href="datum.html">datum</a>/<a href="datum/element.html">element</a>/<a href="datum/element/immerse.html">immerse</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L10"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 10"></a></h1><p>A visual element that makes movables entering the attached turfs look immersed into that turf.
May the gods forgive me for the bullshit you're about to witness</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/element/immerse.html#var/alpha">alpha</a></th><td>Alpha of the mask, to make the liquid partially transparent</td></tr><tr><th><a href="datum/element/immerse.html#var/attached_turf_contents">attached_turf_contents</a></th><td>An association list of turfs that have this element attached and their affected contents.</td></tr><tr><th><a href="datum/element/immerse.html#var/generated_visual_overlays">generated_visual_overlays</a></th><td>An assoc list of instances of /atom/movable/immerse_mask used as abstract effect relays, because god is dead</td></tr><tr><th><a href="datum/element/immerse.html#var/immersion_masks">immersion_masks</a></th><td>A list of generated immersion masks based on object width, height and whever they're fully immersed underwater</td></tr><tr><th><a href="datum/element/immerse.html#var/mask_icon">mask_icon</a></th><td>icon_state used as a mask by our turf</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/element/immerse.html#proc/generate_immerse_mask">generate_immerse_mask</a></th><td>Generate a mask filter mutable to use as render_source for the alpha filter based on provided width, height and immersion state</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_atom_exited">on_atom_exited</a></th><td>Called when a movable exits the turf. If its new location is not in the list of turfs with this element,
remove the movable from the element.</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_init_or_entered">on_init_or_entered</a></th><td>If the movable is within the right layers and planes, not in the list of movable types to ignore,
or already affected by the element for that matter, signals will be registered and,
unless the movable is flying, it'll appear as if immersed in that water.</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_move_flag_disabled">on_move_flag_disabled</a></th><td>Readds the overlay to the mob and bucklees if no longer flying.</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_move_flag_enabled">on_move_flag_enabled</a></th><td>Removes the overlay from mob and bucklees is flying.</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_spin_animation">on_spin_animation</a></th><td>Spin the overlay in the opposite direction so it doesn't look like it's spinning at all.</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_throw">on_throw</a></th><td>Works just like on_move_flag_enabled, except it only has to check that movable isn't flying</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_throw_landed">on_throw_landed</a></th><td>Works just like on_move_flag_disabled, except it only has to check that movable isn't flying</td></tr><tr><th><a href="datum/element/immerse.html#proc/on_update_transform">on_update_transform</a></th><td>A band-aid to keep the (unique) visual overlay from scaling and rotating along with its owner. I'm sorry.</td></tr><tr><th><a href="datum/element/immerse.html#proc/remove_from_element">remove_from_element</a></th><td>Remove any signal, overlay, trait given to the movable and reference to it within the element.</td></tr><tr><th><a href="datum/element/immerse.html#proc/start_immersion">start_immersion</a></th><td>Makes the element start affecting the turf and its contents. Called on Attach() or when TRAIT_IMMERSE_STOPPED is removed.</td></tr><tr><th><a href="datum/element/immerse.html#proc/stop_immersion">stop_immersion</a></th><td>Stops the element from affecting on the turf and its contents. Called on Detach() or when TRAIT_IMMERSE_STOPPED is added.</td></tr><tr><th><a href="datum/element/immerse.html#proc/try_immerse">try_immerse</a></th><td>Called by init_or_entered() and on_set_buckled().
This applies the overlay if neither the movable or whatever is buckled to (exclusive to living mobs) are flying
as well as movetype signals when the movable isn't buckled.</td></tr><tr><th><a href="datum/element/immerse.html#proc/try_unimmerse">try_unimmerse</a></th><td>Called by on_set_buckled() and remove_from_element().
This removes the filter and signals from the movable unless it doesn't have them.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/alpha"><aside class="declaration">var </aside>alpha <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L24"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 24"></a></h3><p>Alpha of the mask, to make the liquid partially transparent</p><h3 id="var/attached_turf_contents"><aside class="declaration">var </aside>attached_turf_contents <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L15"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 15"></a></h3><p>An association list of turfs that have this element attached and their affected contents.</p><h3 id="var/generated_visual_overlays"><aside class="declaration">var </aside>generated_visual_overlays <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L20"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 20"></a></h3><p>An assoc list of instances of /atom/movable/immerse_mask used as abstract effect relays, because god is dead</p><h3 id="var/immersion_masks"><aside class="declaration">var </aside>immersion_masks <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L18"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 18"></a></h3><p>A list of generated immersion masks based on object width, height and whever they're fully immersed underwater</p><h3 id="var/mask_icon"><aside class="declaration">var </aside>mask_icon <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L22"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 22"></a></h3><p>icon_state used as a mask by our turf</p><h2 id="proc">Proc Details</h2><h3 id="proc/generate_immerse_mask"><aside class="declaration">proc </aside>generate_immerse_mask<aside>(width, height, is_below_water)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L200"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 200"></a></aside></h3><p>Generate a mask filter mutable to use as render_source for the alpha filter based on provided width, height and immersion state</p><h3 id="proc/on_atom_exited"><aside class="declaration">proc </aside>on_atom_exited<aside>(/<a href="turf.html">turf</a>/source, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/exited, direction)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L179"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 179"></a></aside></h3><p>Called when a movable exits the turf. If its new location is not in the list of turfs with this element,
remove the movable from the element.</p><h3 id="proc/on_init_or_entered"><aside class="declaration">proc </aside>on_init_or_entered<aside>(/<a href="turf.html">turf</a>/source, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/movable)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L71"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 71"></a></aside></h3><p>If the movable is within the right layers and planes, not in the list of movable types to ignore,
or already affected by the element for that matter, signals will be registered and,
unless the movable is flying, it'll appear as if immersed in that water.</p><h3 id="proc/on_move_flag_disabled"><aside class="declaration">proc </aside>on_move_flag_disabled<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/source, flag, old_movement_type)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L160"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 160"></a></aside></h3><p>Readds the overlay to the mob and bucklees if no longer flying.</p><h3 id="proc/on_move_flag_enabled"><aside class="declaration">proc </aside>on_move_flag_enabled<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/source, flag, old_movement_type)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L142"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 142"></a></aside></h3><p>Removes the overlay from mob and bucklees is flying.</p><h3 id="proc/on_spin_animation"><aside class="declaration">proc </aside>on_spin_animation<aside>(/<a href="atom.html">atom</a>/source, speed, loops, segments, segment)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L287"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 287"></a></aside></h3><p>Spin the overlay in the opposite direction so it doesn't look like it's spinning at all.</p><h3 id="proc/on_throw"><aside class="declaration">proc </aside>on_throw<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L151"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 151"></a></aside></h3><p>Works just like on_move_flag_enabled, except it only has to check that movable isn't flying</p><h3 id="proc/on_throw_landed"><aside class="declaration">proc </aside>on_throw_landed<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L169"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 169"></a></aside></h3><p>Works just like on_move_flag_disabled, except it only has to check that movable isn't flying</p><h3 id="proc/on_update_transform"><aside class="declaration">proc </aside>on_update_transform<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/source, resize, new_lying_angle, is_opposite_angle)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L274"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 274"></a></aside></h3><p>A band-aid to keep the (unique) visual overlay from scaling and rotating along with its owner. I'm sorry.</p><h3 id="proc/remove_from_element"><aside class="declaration">proc </aside>remove_from_element<aside>(/<a href="turf.html">turf</a>/source, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/movable)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L188"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 188"></a></aside></h3><p>Remove any signal, overlay, trait given to the movable and reference to it within the element.</p><h3 id="proc/start_immersion"><aside class="declaration">proc </aside>start_immersion<aside>(/<a href="turf.html">turf</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L48"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 48"></a></aside></h3><p>Makes the element start affecting the turf and its contents. Called on Attach() or when TRAIT_IMMERSE_STOPPED is removed.</p><h3 id="proc/stop_immersion"><aside class="declaration">proc </aside>stop_immersion<aside>(/<a href="turf.html">turf</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L59"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 59"></a></aside></h3><p>Stops the element from affecting on the turf and its contents. Called on Detach() or when TRAIT_IMMERSE_STOPPED is added.</p><h3 id="proc/try_immerse"><aside class="declaration">proc </aside>try_immerse<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/movable, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/buckled)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L110"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 110"></a></aside></h3><p>Called by init_or_entered() and on_set_buckled().
This applies the overlay if neither the movable or whatever is buckled to (exclusive to living mobs) are flying
as well as movetype signals when the movable isn't buckled.</p><h3 id="proc/try_unimmerse"><aside class="declaration">proc </aside>try_unimmerse<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/movable, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/buckled)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/elements/immerse.dm#L123"><img src="git.png" width="16" height="16" title="code/datums/elements/immerse.dm 123"></a></aside></h3><p>Called by on_set_buckled() and remove_from_element().
This removes the filter and signals from the movable unless it doesn't have them.</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f">cd8d3cf</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>