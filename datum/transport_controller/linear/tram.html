<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/transport_controller/linear/tram - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/transport_controller/linear/tram.html#var">Var Details</a> - <a href="datum/transport_controller/linear/tram.html#proc">Proc Details</a></header><main><h1>tram <aside>/<a href="datum.html">datum</a>/<a href="datum/transport_controller/linear.html">transport_controller/linear</a>/<a href="datum/transport_controller/linear/tram.html">tram</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L8"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 8"></a></h1><p>Tram specific variant of the generic linear transport controller.</p>
<p>Hierarchy
The sstransport subsystem manages a list of controllers,
A controller manages a list of transport modules (individual tiles) which together make up a transport unit (in this case a tram)</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/base_internal_movement_delay">base_internal_movement_delay</a></th><td>version of internal_movement_delay that gets set in init and is considered our base delay if our tram gets slowed down</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/collision_lethality">collision_lethality</a></th><td>multiplier on how much damage/force the tram imparts on things it hits</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/controller_active">controller_active</a></th><td>whether this controller is active (any state we don't accept new orders, not nessecarily moving)</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/controller_operational">controller_operational</a></th><td>whether all required parts of the tram are considered operational</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/destination_platform">destination_platform</a></th><td>reference to the destination landmark we consider ourselves travelling towards.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/home_controller">home_controller</a></th><td>the home controller located in telecoms</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/idle_platform">idle_platform</a></th><td>reference to the landmark we consider ourself stationary at.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/internal_movement_delay">internal_movement_delay</a></th><td>decisecond delay between horizontal movement. cannot make the tram move faster than 1 movement per world.tick_lag.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/malf_active">malf_active</a></th><td>if the tram's next stop will be the tram malfunction event sequence</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/nav_beacon">nav_beacon</a></th><td>reference to the navigation landmark associated with this tram. since we potentially span multiple z levels we dont actually
know where on us this platform is. as long as we know THAT its on us we can just move the distance and direction between this
and the destination landmark.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/paired_cabinet">paired_cabinet</a></th><td>the controller cabinet located on the tram</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/recovery_activate_count">recovery_activate_count</a></th><td>how many times we moved while costing more than SStransport.max_time milliseconds per movement.
if this exceeds SStransport.max_exceeding_moves</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/recovery_clear_count">recovery_clear_count</a></th><td>how many times we moved while costing less than 0.5 * SStransport.max_time milliseconds per movement</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/recovery_mode">recovery_mode</a></th><td>whether we have been slowed down automatically</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/scheduled_move">scheduled_move</a></th><td>the world.time we should next move at. in case our speed is set to less than 1 movement per tick</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/tram_history">tram_history</a></th><td>previous trams that have been destroyed</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/tram_max_speed">tram_max_speed</a></th><td>speed of the death machine on rails (in percent)</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/tram_registration">tram_registration</a></th><td>fluff information of the tram, such as ongoing kill count and age</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/travel_direction">travel_direction</a></th><td>if we're travelling, what direction are we going</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/travel_remaining">travel_remaining</a></th><td>if we're travelling, how far do we have to go</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#var/travel_trip_length">travel_trip_length</a></th><td>how far in total we'll be travelling</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/New">New</a></th><td>Make sure all modules have matching speed limiter vars, pull save data from persistence</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/add_transport_modules">add_transport_modules</a></th><td>Register transport modules to the controller</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/calculate_route">calculate_route</a></th><td>Calculate the journey details to the requested platform</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/check_for_landmarks">check_for_landmarks</a></th><td>The mapper should have placed the tram at one of the stations, the controller will search for a landmark within
its control area and set it as its idle position.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/check_starting_landmark">check_starting_landmark</a></th><td>Verify tram is in a valid starting location, start the subsystem.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/closest_nav_in_travel_dir">closest_nav_in_travel_dir</a></th><td>Returns the closest tram nav beacon to an atom</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/crash_fx">crash_fx</a></th><td>Tram crash sound and visuals</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/cycle_doors">cycle_doors</a></th><td>Cycle all the doors on the tram.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/degraded_stop">degraded_stop</a></th><td>Tram comes to an in-station degraded stop, throwing the players. Caused by power loss or tram malfunction event.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/dispatch_transport">dispatch_transport</a></th><td>Handles moving the tram</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/end_malf_event">end_malf_event</a></th><td>Remove effects of tram malfunction event.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/gracefully_break">gracefully_break</a></th><td>The tram explodes if it hits a few types of objects.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/halt_and_catch_fire">halt_and_catch_fire</a></th><td>Tram comes to an emergency stop without completing its trip. Caused by emergency stop button or some catastrophic tram failure.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/normal_stop">normal_stop</a></th><td>Tram stops normally, performs post-trip actions and updates the tram registration.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/process">process</a></th><td>Tram processing loop</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/reset_position">reset_position</a></th><td>Performs a reset of the tram's position data by finding a predetermined reference landmark, then driving to it.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/rod_collision">rod_collision</a></th><td>Moves the tram when hit by an immovable rod</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/set_active">set_active</a></th><td>Sets the active status for the controller and sends a signal to listeners.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/set_status_code">set_status_code</a></th><td>Sets the controller status bitfield</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/start_malf_event">start_malf_event</a></th><td>Tram malfunction random event. Set comm error, requiring engineering or AI intervention.</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/unlock_controls">unlock_controls</a></th><td>Handles unlocking the tram controls for use after moving</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/update_status">update_status</a></th><td>Part of the pre-departure list, checks the status of the doors on the tram</td></tr><tr><th><a href="datum/transport_controller/linear/tram.html#proc/vv_edit_var">vv_edit_var</a></th><td>We expect people to VV tram_max_speed, and set the appropriate internal_movement_delay/base_internal_movement_delay.
But if they set one of the internals, we should also update tram_max_speed to reflect it.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/base_internal_movement_delay"><aside class="declaration">var </aside>base_internal_movement_delay <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L41"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 41"></a></h3><p>version of internal_movement_delay that gets set in init and is considered our base delay if our tram gets slowed down</p><h3 id="var/collision_lethality"><aside class="declaration">var </aside>collision_lethality <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L24"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 24"></a></h3><p>multiplier on how much damage/force the tram imparts on things it hits</p><h3 id="var/controller_active"><aside class="declaration">var </aside>controller_active <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L10"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 10"></a></h3><p>whether this controller is active (any state we don't accept new orders, not nessecarily moving)</p><h3 id="var/controller_operational"><aside class="declaration">var </aside>controller_operational <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L12"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 12"></a></h3><p>whether all required parts of the tram are considered operational</p><h3 id="var/destination_platform"><aside class="declaration">var </aside>destination_platform <aside>– /<a href="obj.html">obj</a>/<a href="obj/effect/landmark/transport/nav_beacon/tram.html">effect/landmark/transport/nav_beacon/tram</a>/platform</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L32"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 32"></a></h3><p>reference to the destination landmark we consider ourselves travelling towards.</p><h3 id="var/home_controller"><aside class="declaration">var </aside>home_controller <aside>– /<a href="obj.html">obj</a>/<a href="obj/machinery.html">machinery</a>/<a href="obj/machinery/transport.html">transport</a>/<a href="obj/machinery/transport/tram_controller.html">tram_controller</a>/<a href="obj/machinery/transport/tram_controller/tcomms.html">tcomms</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L16"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 16"></a></h3><p>the home controller located in telecoms</p><h3 id="var/idle_platform"><aside class="declaration">var </aside>idle_platform <aside>– /<a href="obj.html">obj</a>/<a href="obj/effect/landmark/transport/nav_beacon/tram.html">effect/landmark/transport/nav_beacon/tram</a>/platform</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L30"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 30"></a></h3><p>reference to the landmark we consider ourself stationary at.</p><h3 id="var/internal_movement_delay"><aside class="declaration">var </aside>internal_movement_delay <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L38"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 38"></a></h3><p>decisecond delay between horizontal movement. cannot make the tram move faster than 1 movement per world.tick_lag.</p><h3 id="var/malf_active"><aside class="declaration">var </aside>malf_active <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L60"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 60"></a></h3><p>if the tram's next stop will be the tram malfunction event sequence</p><h3 id="var/nav_beacon"><aside class="declaration">var </aside>nav_beacon <aside>– /<a href="obj.html">obj</a>/<a href="obj/effect/landmark/transport/nav_beacon/tram.html">effect/landmark/transport/nav_beacon/tram</a>/nav</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L28"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 28"></a></h3><p>reference to the navigation landmark associated with this tram. since we potentially span multiple z levels we dont actually
know where on us this platform is. as long as we know THAT its on us we can just move the distance and direction between this
and the destination landmark.</p><h3 id="var/paired_cabinet"><aside class="declaration">var </aside>paired_cabinet <aside>– /<a href="obj.html">obj</a>/<a href="obj/machinery.html">machinery</a>/<a href="obj/machinery/transport.html">transport</a>/<a href="obj/machinery/transport/tram_controller.html">tram_controller</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L14"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 14"></a></h3><p>the controller cabinet located on the tram</p><h3 id="var/recovery_activate_count"><aside class="declaration">var </aside>recovery_activate_count <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L54"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 54"></a></h3><p>how many times we moved while costing more than SStransport.max_time milliseconds per movement.
if this exceeds SStransport.max_exceeding_moves</p><h3 id="var/recovery_clear_count"><aside class="declaration">var </aside>recovery_clear_count <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L57"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 57"></a></h3><p>how many times we moved while costing less than 0.5 * SStransport.max_time milliseconds per movement</p><h3 id="var/recovery_mode"><aside class="declaration">var </aside>recovery_mode <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L50"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 50"></a></h3><p>whether we have been slowed down automatically</p><h3 id="var/scheduled_move"><aside class="declaration">var </aside>scheduled_move <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L47"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 47"></a></h3><p>the world.time we should next move at. in case our speed is set to less than 1 movement per tick</p><h3 id="var/tram_history"><aside class="declaration">var </aside>tram_history <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L66"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 66"></a></h3><p>previous trams that have been destroyed</p><h3 id="var/tram_max_speed"><aside class="declaration">var </aside>tram_max_speed <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L44"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 44"></a></h3><p>speed of the death machine on rails (in percent)</p><h3 id="var/tram_registration"><aside class="declaration">var </aside>tram_registration <aside>– /<a href="datum.html">datum</a>/<a href="datum/tram_mfg_info.html">tram_mfg_info</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L63"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 63"></a></h3><p>fluff information of the tram, such as ongoing kill count and age</p><h3 id="var/travel_direction"><aside class="declaration">var </aside>travel_direction <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L18"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 18"></a></h3><p>if we're travelling, what direction are we going</p><h3 id="var/travel_remaining"><aside class="declaration">var </aside>travel_remaining <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L20"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 20"></a></h3><p>if we're travelling, how far do we have to go</p><h3 id="var/travel_trip_length"><aside class="declaration">var </aside>travel_trip_length <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L22"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 22"></a></h3><p>how far in total we'll be travelling</p><h2 id="proc">Proc Details</h2><h3 id="proc/New">New<aside>(/<a href="obj.html">obj</a>/<a href="obj/structure.html">structure</a>/<a href="obj/structure/transport/linear.html">transport/linear</a>/<a href="obj/structure/transport/linear/tram.html">tram</a>/transport_module)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L122"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 122"></a></aside></h3><p>Make sure all modules have matching speed limiter vars, pull save data from persistence</p>
<p>We track a few stats about it, and keep a small historical record on the
information plate inside the tram.</p><h3 id="proc/add_transport_modules">add_transport_modules<aside>(/<a href="obj.html">obj</a>/<a href="obj/structure.html">structure</a>/<a href="obj/structure/transport/linear.html">transport/linear</a>/new_transport_module)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L167"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 167"></a></aside></h3><p>Register transport modules to the controller</p>
<p>Spreads out searching neighbouring tiles for additional transport modules, to combine into one full tram.
We register to every module's signal that it's collided with something, be it mob, structure, etc.</p><h3 id="proc/calculate_route"><aside class="declaration">proc </aside>calculate_route<aside>(/<a href="obj.html">obj</a>/<a href="obj/effect/landmark/transport/nav_beacon/tram.html">effect/landmark/transport/nav_beacon/tram</a>/destination)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L241"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 241"></a></aside></h3><p>Calculate the journey details to the requested platform</p>
<p>These will eventually be passed to the transport modules as args telling them where to move.
We do some sanity checking in case of discrepencany between where the subsystem thinks the
tram is and where the tram actually is. (For example, moving the landmarks after round start.)</p><h3 id="proc/check_for_landmarks"><aside class="parent"><a title="/datum/transport_controller/linear" href="datum/transport_controller/linear.html#proc/check_for_landmarks">↑</a></aside>check_for_landmarks<aside>(/<a href="obj.html">obj</a>/<a href="obj/structure.html">structure</a>/<a href="obj/structure/transport/linear.html">transport/linear</a>/<a href="obj/structure/transport/linear/tram.html">tram</a>/new_transport_module)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L175"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 175"></a></aside></h3><p>The mapper should have placed the tram at one of the stations, the controller will search for a landmark within
its control area and set it as its idle position.</p><h3 id="proc/check_starting_landmark"><aside class="declaration">proc </aside>check_starting_landmark<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L195"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 195"></a></aside></h3><p>Verify tram is in a valid starting location, start the subsystem.</p>
<p>Throw an error if someone mapped a tram with no landmarks available for it to register.
The processing subsystem starts off because not all maps have elevators/transports.
Now that the tram is aware of its surroundings, we start the subsystem.</p><h3 id="proc/closest_nav_in_travel_dir"><aside class="declaration">proc </aside>closest_nav_in_travel_dir<aside>(/<a href="atom.html">atom</a>/origin, travel_dir, beacon_type)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L668"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 668"></a></aside></h3><p>Returns the closest tram nav beacon to an atom</p>
<p>Creates a list of nav beacons in the requested direction
and returns the closest to be passed to the industrial_lift</p>
<p>Arguments: source: the starting point to find a beacon
travel_dir: travel direction in tram form, INBOUND or OUTBOUND
beacon_type: what list of beacons we pull from</p><h3 id="proc/crash_fx"><aside class="declaration">proc </aside>crash_fx<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L484"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 484"></a></aside></h3><p>Tram crash sound and visuals</p><h3 id="proc/cycle_doors"><aside class="declaration">proc </aside>cycle_doors<aside>(door_status, rapid)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L566"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 566"></a></aside></h3><p>Cycle all the doors on the tram.</p><h3 id="proc/degraded_stop"><aside class="declaration">proc </aside>degraded_stop<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L379"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 379"></a></aside></h3><p>Tram comes to an in-station degraded stop, throwing the players. Caused by power loss or tram malfunction event.</p><h3 id="proc/dispatch_transport"><aside class="declaration">proc </aside>dispatch_transport<aside>(/<a href="obj.html">obj</a>/<a href="obj/effect/landmark/transport/nav_beacon/tram.html">effect/landmark/transport/nav_beacon/tram</a>/destination_platform)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L266"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 266"></a></aside></h3><p>Handles moving the tram</p>
<p>Called by the subsystem, the controller tells the individual tram parts where to actually go and has extra safety checks
incase multiple inputs get through, preventing conflicting directions and the tram literally ripping itself apart.
All of the actual movement is handled by SStransport.</p>
<p>If we're this far all the PRE_DEPARTURE checks should have passed, so we leave the PRE_DEPARTURE status and actually move.
We send a signal to anything registered that cares about the physical movement of the tram.</p>
<p>Arguments:</p>
<ul>
<li>destination_platform - where the subsystem wants it to go</li>
</ul><h3 id="proc/end_malf_event"><aside class="declaration">proc </aside>end_malf_event<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L628"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 628"></a></aside></h3><p>Remove effects of tram malfunction event.</p>
<p>If engineers didn't already repair the tram by the end of the event,
automagically reset it remotely.</p><h3 id="proc/gracefully_break"><aside class="declaration">proc </aside>gracefully_break<aside>(/<a href="atom.html">atom</a>/bumped_atom)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L211"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 211"></a></aside></h3><p>The tram explodes if it hits a few types of objects.</p>
<p>Signal for when the tram runs into a field of which it cannot go through.
Stops the train's travel fully, sends a message, and destroys the train.
Arguments:</p>
<ul>
<li>bumped_atom - The atom this tram bumped into</li>
</ul><h3 id="proc/halt_and_catch_fire"><aside class="declaration">proc </aside>halt_and_catch_fire<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L408"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 408"></a></aside></h3><p>Tram comes to an emergency stop without completing its trip. Caused by emergency stop button or some catastrophic tram failure.</p><h3 id="proc/normal_stop"><aside class="declaration">proc </aside>normal_stop<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L360"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 360"></a></aside></h3><p>Tram stops normally, performs post-trip actions and updates the tram registration.</p><h3 id="proc/process"><aside class="parent"><a title="/datum" href="datum.html#proc/process">↑</a></aside>process<aside>(seconds_per_tick)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L303"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 303"></a></aside></h3><p>Tram processing loop</p>
<p>Moves the tram to its set destination.
When it arrives at its destination perform callback to the post-arrival procs like controls and lights.
We update the odometer and kill the process until we need to move again.</p>
<p>If the status is EMERGENCY_STOP the tram should immediately come to a stop regardless of the travel_remaining.
Some extra things happen in an emergency stop (throwing the passengers) and when reset will run a
recovery procedure to head to the nearest platform and sync logical and physical location data
(idle_platform and nav_beacon) once the issue is resolved.</p><h3 id="proc/reset_position"><aside class="declaration">proc </aside>reset_position<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L434"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 434"></a></aside></h3><p>Performs a reset of the tram's position data by finding a predetermined reference landmark, then driving to it.</p><h3 id="proc/rod_collision"><aside class="declaration">proc </aside>rod_collision<aside>(/<a href="obj.html">obj</a>/<a href="obj/effect/immovablerod.html">effect/immovablerod</a>/collided_rod)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L725"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 725"></a></aside></h3><p>Moves the tram when hit by an immovable rod</p>
<p>Tells the individual tram parts where to actually go and has an extra safety checks
incase multiple inputs get through, preventing conflicting directions and the tram
literally ripping itself apart. all of the actual movement is handled by SStramprocess</p>
<p>Arguments: collided_rod (the immovable rod that hit the tram)
Return: push_destination (the landmark /obj/effect/landmark/tram/nav that the tram is being pushed to due to the rod's trajectory)</p><h3 id="proc/set_active"><aside class="declaration">proc </aside>set_active<aside>(new_status)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L513"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 513"></a></aside></h3><p>Sets the active status for the controller and sends a signal to listeners.</p>
<p>The main signal used by most components, it has the active status, the bitfield of the controller's status, its direction, and set destination.</p>
<p>Arguments:
new_status - The active status of the controller (whether it's busy doing something and not taking commands right now)</p><h3 id="proc/set_status_code"><aside class="declaration">proc </aside>set_status_code<aside>(code, value)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L532"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 532"></a></aside></h3><p>Sets the controller status bitfield</p>
<p>This status var is used by various components like lights, crossing signals, signs
Sent via signal the listening components will perform required actions based on
the status codes.</p>
<p>Arguments:</p>
<ul>
<li>code - The status bitflag we're changing</li>
<li>value - boolean TRUE/FALSE to set the code</li>
</ul><h3 id="proc/start_malf_event"><aside class="declaration">proc </aside>start_malf_event<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L616"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 616"></a></aside></h3><p>Tram malfunction random event. Set comm error, requiring engineering or AI intervention.</p><h3 id="proc/unlock_controls"><aside class="declaration">proc </aside>unlock_controls<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L499"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 499"></a></aside></h3><p>Handles unlocking the tram controls for use after moving</p>
<p>More safety checks to make sure the tram has actually docked properly
at a location before users are allowed to interact with the tram console again.
Tram finds its location at this point before fully unlocking controls to the user.</p><h3 id="proc/update_status"><aside class="declaration">proc </aside>update_status<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L552"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 552"></a></aside></h3><p>Part of the pre-departure list, checks the status of the doors on the tram</p>
<p>Checks if all doors are closed, and updates the status code accordingly.</p>
<p>TODO: this is probably better renamed check_door_status()</p><h3 id="proc/vv_edit_var"><aside class="parent"><a title="/datum" href="datum.html#proc/vv_edit_var">↑</a></aside>vv_edit_var<aside>(var_name, var_value)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/transport/tram/tram_controller.dm#L141"><img src="git.png" width="16" height="16" title="code/modules/transport/tram/tram_controller.dm 141"></a></aside></h3><p>We expect people to VV tram_max_speed, and set the appropriate internal_movement_delay/base_internal_movement_delay.
But if they set one of the internals, we should also update tram_max_speed to reflect it.</p>
<p>You cannot make the tram move faster than 1 movement per world.tick_lag, so our lower limit is 0.5 (tram_max_speed 100)</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f">cd8d3cf</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>