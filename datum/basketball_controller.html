<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/basketball_controller - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/basketball_controller.html#var">Var Details</a> - <a href="datum/basketball_controller.html#proc">Proc Details</a></header><main><h1>basketball_controller <aside>/<a href="datum.html">datum</a>/<a href="datum/basketball_controller.html">basketball_controller</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L19"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 19"></a></h1><p>The basketball controller handles the basketball minigame in progress.
It is first created when the first ghost signs up to play.</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/basketball_controller.html#var/away_hoop">away_hoop</a></th><td>The basketball hoop used by away team</td></tr><tr><th><a href="datum/basketball_controller.html#var/away_team_ckeys">away_team_ckeys</a></th><td>List of away team players ckeys</td></tr><tr><th><a href="datum/basketball_controller.html#var/away_team_landmarks">away_team_landmarks</a></th><td>Spawn points for away team players</td></tr><tr><th><a href="datum/basketball_controller.html#var/current_map">current_map</a></th><td>Template picked when the game starts. used for the name and desc reading</td></tr><tr><th><a href="datum/basketball_controller.html#var/game_duration">game_duration</a></th><td>Total amount of time basketball is played for</td></tr><tr><th><a href="datum/basketball_controller.html#var/home_hoop">home_hoop</a></th><td>The basketball hoop used by home team</td></tr><tr><th><a href="datum/basketball_controller.html#var/home_team_ckeys">home_team_ckeys</a></th><td>List of home team players ckeys</td></tr><tr><th><a href="datum/basketball_controller.html#var/home_team_landmarks">home_team_landmarks</a></th><td>Spawn points for home team players</td></tr><tr><th><a href="datum/basketball_controller.html#var/location">location</a></th><td>Our turf reservation AKA where the arena is</td></tr><tr><th><a href="datum/basketball_controller.html#var/minigame_basketball_mobs">minigame_basketball_mobs</a></th><td>List of all player mobs involved in the minigame</td></tr><tr><th><a href="datum/basketball_controller.html#var/minigame_players_ckeys">minigame_players_ckeys</a></th><td>List of all players ckeys involved in the minigame</td></tr><tr><th><a href="datum/basketball_controller.html#var/referee_landmark">referee_landmark</a></th><td>Spawn point for referee (there should only be one spot on minigame map)</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/basketball_controller.html#proc/basic_setup">basic_setup</a></th><td>Called when enough players have signed up to fill a setup. DOESN'T NECESSARILY MEAN THE GAME WILL START.</td></tr><tr><th><a href="datum/basketball_controller.html#proc/check_signups">check_signups</a></th><td>Filters inactive player into a different list until they reconnect, and removes players who are no longer ghosts.</td></tr><tr><th><a href="datum/basketball_controller.html#proc/create_bodies">create_bodies</a></th><td>Called when the game is setting up, AFTER map is loaded but BEFORE the game start. Creates and places each body and gives the correct player key</td></tr><tr><th><a href="datum/basketball_controller.html#proc/end_game">end_game</a></th><td>Cleans up the game, resetting variables back to the beginning and removing the map with the generator.</td></tr><tr><th><a href="datum/basketball_controller.html#proc/prepare_game">prepare_game</a></th><td>Triggers at beginning of the game when there is a confirmed list of valid, ready players.
Creates a 100% ready game that has NOT started (no players in bodies)
Followed by start game</td></tr><tr><th><a href="datum/basketball_controller.html#proc/start_game">start_game</a></th><td>The game by this point is now all set up, and so we can put people in their bodies.</td></tr><tr><th><a href="datum/basketball_controller.html#proc/try_autostart">try_autostart</a></th><td>Called when someone signs up, and sees if there are enough people in the signup list to begin.</td></tr><tr><th><a href="datum/basketball_controller.html#proc/victory">victory</a></th><td>Called after the game is finished. Sends end game notifications to teams and dusts the losers.</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/away_hoop"><aside class="declaration">var </aside>away_hoop <aside>– /<a href="obj.html">obj</a>/<a href="obj/structure.html">structure</a>/<a href="obj/structure/hoop.html">hoop</a>/<a href="obj/structure/hoop/minigame.html">minigame</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L45"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 45"></a></h3><p>The basketball hoop used by away team</p><h3 id="var/away_team_ckeys"><aside class="declaration">var </aside>away_team_ckeys <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L43"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 43"></a></h3><p>List of away team players ckeys</p><h3 id="var/away_team_landmarks"><aside class="declaration">var </aside>away_team_landmarks <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L41"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 41"></a></h3><p>Spawn points for away team players</p><h3 id="var/current_map"><aside class="declaration">var </aside>current_map <aside>– /<a href="datum.html">datum</a>/<a href="datum/lazy_template.html">lazy_template</a>/<a href="datum/lazy_template/basketball.html">basketball</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L21"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 21"></a></h3><p>Template picked when the game starts. used for the name and desc reading</p><h3 id="var/game_duration"><aside class="declaration">var </aside>game_duration <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L25"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 25"></a></h3><p>Total amount of time basketball is played for</p><h3 id="var/home_hoop"><aside class="declaration">var </aside>home_hoop <aside>– /<a href="obj.html">obj</a>/<a href="obj/structure.html">structure</a>/<a href="obj/structure/hoop.html">hoop</a>/<a href="obj/structure/hoop/minigame.html">minigame</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L38"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 38"></a></h3><p>The basketball hoop used by home team</p><h3 id="var/home_team_ckeys"><aside class="declaration">var </aside>home_team_ckeys <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L35"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 35"></a></h3><p>List of home team players ckeys</p><h3 id="var/home_team_landmarks"><aside class="declaration">var </aside>home_team_landmarks <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L33"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 33"></a></h3><p>Spawn points for home team players</p><h3 id="var/location"><aside class="declaration">var </aside>location <aside>– /<a href="datum.html">datum</a>/<a href="datum/turf_reservation.html">turf_reservation</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L23"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 23"></a></h3><p>Our turf reservation AKA where the arena is</p><h3 id="var/minigame_basketball_mobs"><aside class="declaration">var </aside>minigame_basketball_mobs <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L30"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 30"></a></h3><p>List of all player mobs involved in the minigame</p><h3 id="var/minigame_players_ckeys"><aside class="declaration">var </aside>minigame_players_ckeys <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L28"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 28"></a></h3><p>List of all players ckeys involved in the minigame</p><h3 id="var/referee_landmark"><aside class="declaration">var </aside>referee_landmark <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L48"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 48"></a></h3><p>Spawn point for referee (there should only be one spot on minigame map)</p><h2 id="proc">Proc Details</h2><h3 id="proc/basic_setup"><aside class="declaration">proc </aside>basic_setup<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L280"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 280"></a></aside></h3><p>Called when enough players have signed up to fill a setup. DOESN'T NECESSARILY MEAN THE GAME WILL START.</p>
<p>Checks for a custom setup, if so gets the required players from that and if not it sets the player requirement to BASKETBALL_MAX_PLAYER_COUNT and generates one IF basic setup starts a game.
Checks if everyone signed up is an observer, and is still connected. If people aren't, they're removed from the list.
If there aren't enough players post sanity, it aborts. otherwise, it selects enough people for the game and starts preparing the game for real.</p><h3 id="proc/check_signups"><aside class="declaration">proc </aside>check_signups<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L317"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 317"></a></aside></h3><p>Filters inactive player into a different list until they reconnect, and removes players who are no longer ghosts.</p><h3 id="proc/create_bodies"><aside class="declaration">proc </aside>create_bodies<aside>(ready_players)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L137"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 137"></a></aside></h3><p>Called when the game is setting up, AFTER map is loaded but BEFORE the game start. Creates and places each body and gives the correct player key</p><h3 id="proc/end_game"><aside class="declaration">proc </aside>end_game<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L257"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 257"></a></aside></h3><p>Cleans up the game, resetting variables back to the beginning and removing the map with the generator.</p><h3 id="proc/prepare_game"><aside class="declaration">proc </aside>prepare_game<aside>(ready_players)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L76"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 76"></a></aside></h3><p>Triggers at beginning of the game when there is a confirmed list of valid, ready players.
Creates a 100% ready game that has NOT started (no players in bodies)
Followed by start game</p>
<p>Does the following:</p>
<ul>
<li>Picks map, and loads it</li>
<li>Grabs landmarks if it is the first time it's loading</li>
<li>Puts players in each team randomly
Arguments:</li>
<li>ready_players: list of filtered, sane players (so not playing or disconnected) for the game to put into roles</li>
</ul><h3 id="proc/start_game"><aside class="declaration">proc </aside>start_game<aside>(ready_players)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L115"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 115"></a></aside></h3><p>The game by this point is now all set up, and so we can put people in their bodies.</p><h3 id="proc/try_autostart"><aside class="declaration">proc </aside>try_autostart<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L338"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 338"></a></aside></h3><p>Called when someone signs up, and sees if there are enough people in the signup list to begin.</p>
<p>Only checks if everyone is actually valid to start (still connected and an observer) if there are enough players (basic_setup)</p><h3 id="proc/victory"><aside class="declaration">proc </aside>victory<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/modules/basketball/controller.dm#L216"><img src="git.png" width="16" height="16" title="code/modules/basketball/controller.dm 216"></a></aside></h3><p>Called after the game is finished. Sends end game notifications to teams and dusts the losers.</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f">cd8d3cf</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>