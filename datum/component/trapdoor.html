<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/component/trapdoor - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/component/trapdoor.html#var">Var Details</a> - <a href="datum/component/trapdoor.html#proc">Proc Details</a></header><main><h1>trapdoor <aside>/<a href="datum.html">datum</a>/<a href="datum/component.html">component</a>/<a href="datum/component/trapdoor.html">trapdoor</a></aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L13"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 13"></a></h1><h2 id="trapdoor-component">trapdoor component!</h2>
<p>component attached to floors to turn them into trapdoors, a constructable trap that when signalled drops people to the level below.
assembly code at the bottom of this file</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/component/trapdoor.html#var/assembly">assembly</a></th><td>assembly tied to this trapdoor</td></tr><tr><th><a href="datum/component/trapdoor.html#var/autoclose">autoclose</a></th><td>Trapdoor shuts close automatically</td></tr><tr><th><a href="datum/component/trapdoor.html#var/autoclose_delay">autoclose_delay</a></th><td>Delay before trapdoor shuts close</td></tr><tr><th><a href="datum/component/trapdoor.html#var/conspicuous">conspicuous</a></th><td>is this trapdoor &quot;conspicuous&quot; (ie. it gets examine text and overlay added)</td></tr><tr><th><a href="datum/component/trapdoor.html#var/stored_decals">stored_decals</a></th><td>list of lists that are arguments for readding decals when the linked trapdoor comes back. pain.</td></tr><tr><th><a href="datum/component/trapdoor.html#var/trapdoor_overlay">trapdoor_overlay</a></th><td>overlay that makes trapdoors more obvious</td></tr><tr><th><a href="datum/component/trapdoor.html#var/trapdoor_turf_path">trapdoor_turf_path</a></th><td>path of the turf this should change into when the assembly is pulsed. needed for openspace trapdoors knowing what to turn back into</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/component/trapdoor.html#proc/apply_decal">apply_decal</a></th><td>small proc that takes passed arguments and drops it into a new element</td></tr><tr><th><a href="datum/component/trapdoor.html#proc/carry_over_trapdoor">carry_over_trapdoor</a></th><td></td></tr><tr><th><a href="datum/component/trapdoor.html#proc/on_examine">on_examine</a></th><td></td></tr><tr><th><a href="datum/component/trapdoor.html#proc/on_link_requested">on_link_requested</a></th><td>called by linking remotes to tie an assembly to the trapdoor</td></tr><tr><th><a href="datum/component/trapdoor.html#proc/openspace_trapdoor_setup">openspace_trapdoor_setup</a></th><td>initializing as an opened trapdoor, we need to trust that we were given the data by a closed trapdoor</td></tr><tr><th><a href="datum/component/trapdoor.html#proc/reapply_all_decals">reapply_all_decals</a></th><td></td></tr><tr><th><a href="datum/component/trapdoor.html#proc/tile_trapdoor_setup">tile_trapdoor_setup</a></th><td>initializing as a closed trapdoor, we need to take data from the tile we're on to give it to the open state to store</td></tr><tr><th><a href="datum/component/trapdoor.html#proc/toggle_trapdoor">toggle_trapdoor</a></th><td>signal called by our assembly being pulsed</td></tr><tr><th><a href="datum/component/trapdoor.html#proc/try_closing">try_closing</a></th><td></td></tr><tr><th><a href="datum/component/trapdoor.html#proc/try_opening">try_opening</a></th><td></td></tr><tr><th><a href="datum/component/trapdoor.html#proc/turf_changed_pre">turf_changed_pre</a></th><td>signal called by turf changing</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/assembly"><aside class="declaration">var </aside>assembly <aside>– /<a href="obj.html">obj</a>/<a href="obj/item.html">item</a>/<a href="obj/item/assembly.html">assembly</a>/<a href="obj/item/assembly/trapdoor.html">trapdoor</a></aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L15"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 15"></a></h3><p>assembly tied to this trapdoor</p><h3 id="var/autoclose"><aside class="declaration">var </aside>autoclose <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L32"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 32"></a></h3><p>Trapdoor shuts close automatically</p><h3 id="var/autoclose_delay"><aside class="declaration">var </aside>autoclose_delay <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L34"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 34"></a></h3><p>Delay before trapdoor shuts close</p><h3 id="var/conspicuous"><aside class="declaration">var </aside>conspicuous <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L19"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 19"></a></h3><p>is this trapdoor &quot;conspicuous&quot; (ie. it gets examine text and overlay added)</p><h3 id="var/stored_decals"><aside class="declaration">var </aside>stored_decals <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L30"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 30"></a></h3><p>list of lists that are arguments for readding decals when the linked trapdoor comes back. pain.</p>
<p>we are storing this data FOR the trapdoor component we are linked to. kinda like a multitool.
format: list(list(element's description, element's cleanable, element's directional, element's pic))
the list will be filled with all the data of the deleting elements (when ChangeTurf is called) only when the trapdoor begins to open.
so any other case the elements will be changed but not recorded.</p><h3 id="var/trapdoor_overlay"><aside class="declaration">var </aside>trapdoor_overlay <aside>– /static</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L21"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 21"></a></h3><p>overlay that makes trapdoors more obvious</p><h3 id="var/trapdoor_turf_path"><aside class="declaration">var </aside>trapdoor_turf_path <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L17"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 17"></a></h3><p>path of the turf this should change into when the assembly is pulsed. needed for openspace trapdoors knowing what to turn back into</p><h2 id="proc">Proc Details</h2><h3 id="proc/apply_decal"><aside class="declaration">proc </aside>apply_decal<aside>(description, cleanable, directional, pic)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L164"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 164"></a></aside></h3><p>small proc that takes passed arguments and drops it into a new element</p><h3 id="proc/carry_over_trapdoor"><aside class="declaration">proc </aside>carry_over_trapdoor<aside>(trapdoor_turf_path, conspicuous, assembly, /<a href="turf.html">turf</a>/new_turf)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L212"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 212"></a></aside></h3><h2 id="carry-over-trapdoor">carry_over_trapdoor</h2>
<p>applies the trapdoor to the new turf (created by the last trapdoor)
apparently callbacks with arguments on invoke and the callback itself have the callback args go first. interesting!</p><h3 id="proc/on_examine"><aside class="declaration">proc </aside>on_examine<aside>(/<a href="datum.html">datum</a>/source, /<a href="mob.html">mob</a>/user, /list/examine_text)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L220"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 220"></a></aside></h3><h2 id="on-examine">on_examine</h2>
<p>examine message for conspicuous trapdoors that makes it obvious</p><h3 id="proc/on_link_requested"><aside class="declaration">proc </aside>on_link_requested<aside>(/<a href="datum.html">datum</a>/source, /<a href="obj.html">obj</a>/<a href="obj/item.html">item</a>/<a href="obj/item/assembly.html">assembly</a>/<a href="obj/item/assembly/trapdoor.html">trapdoor</a>/assembly)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L168"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 168"></a></aside></h3><p>called by linking remotes to tie an assembly to the trapdoor</p><h3 id="proc/openspace_trapdoor_setup"><aside class="declaration">proc </aside>openspace_trapdoor_setup<aside>(trapdoor_turf_path)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L60"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 60"></a></aside></h3><p>initializing as an opened trapdoor, we need to trust that we were given the data by a closed trapdoor</p><h3 id="proc/reapply_all_decals"><aside class="declaration">proc </aside>reapply_all_decals<aside>()  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L158"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 158"></a></aside></h3><h2 id="reapply-all-decals">reapply_all_decals</h2>
<p>changing turfs does not bring over decals, so we must perform a little bit of element reapplication.</p><h3 id="proc/tile_trapdoor_setup"><aside class="declaration">proc </aside>tile_trapdoor_setup<aside>(trapdoor_turf_path)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L64"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 64"></a></aside></h3><p>initializing as a closed trapdoor, we need to take data from the tile we're on to give it to the open state to store</p><h3 id="proc/toggle_trapdoor"><aside class="declaration">proc </aside>toggle_trapdoor<aside>(/<a href="datum.html">datum</a>/source)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L180"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 180"></a></aside></h3><p>signal called by our assembly being pulsed</p><h3 id="proc/try_closing"><aside class="declaration">proc </aside>try_closing<aside>()  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L246"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 246"></a></aside></h3><h2 id="try-closing">try_closing</h2>
<p>small proc for closing the turf back into what it should be
trapdoor can be blocked by building things on the openspace turf</p><h3 id="proc/try_opening"><aside class="declaration">proc </aside>try_opening<aside>()  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L231"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 231"></a></aside></h3><h2 id="try-opening">try_opening</h2>
<p>small proc for opening the turf into openspace
there are no checks for opening a trapdoor, but closed has some</p><h3 id="proc/turf_changed_pre"><aside class="declaration">proc </aside>turf_changed_pre<aside>(/<a href="datum.html">datum</a>/source, path, new_baseturfs, flags, post_change_callbacks)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/trapdoor.dm#L190"><img src="git.png" width="16" height="16" title="code/datums/components/trapdoor.dm 190"></a></aside></h3><p>signal called by turf changing</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/c41b333c9bc46606d2c5d5b517f7836d5953fbfd">c41b333</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>