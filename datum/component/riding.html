<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/component/riding - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/component/riding.html#var">Var Details</a> - <a href="datum/component/riding.html#proc">Proc Details</a></header><main><h1>riding <aside>/<a href="datum.html">datum</a>/<a href="datum/component.html">component</a>/<a href="datum/component/riding.html">riding</a></aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L14"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 14"></a></h1><p>This is the riding component, which is applied to a movable atom by the <a href="datum/element/ridable.html" title="/datum/element/ridable">ridable element</a> when a mob is successfully buckled to said movable.</p>
<p>This component lives for as long as at least one mob is buckled to the parent. Once all mobs are unbuckled, the component is deleted, until another mob is buckled in
and we make a new riding component, so on and so forth until the sun explodes.</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/component/riding.html#var/allowed_turf_typecache">allowed_turf_typecache</a></th><td>allow typecache for only certain turfs, forbid to allow all but those. allow only certain turfs will take precedence.</td></tr><tr><th><a href="datum/component/riding.html#var/can_force_unbuckle">can_force_unbuckle</a></th><td>can anyone other than the rider unbuckle the rider?</td></tr><tr><th><a href="datum/component/riding.html#var/forbid_turf_typecache">forbid_turf_typecache</a></th><td>allow typecache for only certain turfs, forbid to allow all but those. allow only certain turfs will take precedence.</td></tr><tr><th><a href="datum/component/riding.html#var/keytype">keytype</a></th><td>If the driver needs a certain item in hand (or inserted, for vehicles) to drive this. For vehicles, this must be duplicated on the actual vehicle object in their
<a href="obj/vehicle.html#var/key_type" title="/obj/vehicle">/obj/vehicle/var/key_type</a> variable because the vehicle objects still have a few special checks/functions of their own I'm not porting over to the riding component
quite yet. Make sure if you define it on the vehicle, you define it here too.</td></tr><tr><th><a href="datum/component/riding.html#var/message_cooldown">message_cooldown</a></th><td>For telling someone they can't drive</td></tr><tr><th><a href="datum/component/riding.html#var/override_allow_spacemove">override_allow_spacemove</a></th><td>We don't need roads where we're going if this is TRUE, allow normal movement in space tiles</td></tr><tr><th><a href="datum/component/riding.html#var/ride_check_flags">ride_check_flags</a></th><td>Ride check flags defined for the specific riding component types, so we know if we need arms, legs, or whatever.
Takes additional flags from the ridable element and the buckle proc (buckle_mob_flags) for riding cyborgs/humans in case we need to reserve arms</td></tr><tr><th><a href="datum/component/riding.html#var/rider_traits">rider_traits</a></th><td>additional traits to add to anyone riding this vehicle</td></tr><tr><th><a href="datum/component/riding.html#var/vehicle_move_cooldown">vehicle_move_cooldown</a></th><td>For telling someone they can't drive</td></tr><tr><th><a href="datum/component/riding.html#var/vehicle_move_delay">vehicle_move_delay</a></th><td>Tick delay between movements, lower = faster, higher = slower</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/component/riding.html#proc/driver_move">driver_move</a></th><td>Every time the driver tries to move, this is called to see if they can actually drive and move the vehicle (via relaymove)</td></tr><tr><th><a href="datum/component/riding.html#proc/get_parent_offsets_and_layers">get_parent_offsets_and_layers</a></th><td>Determines where the parent gets offset while riders are riding</td></tr><tr><th><a href="datum/component/riding.html#proc/get_rider_offsets_and_layers">get_rider_offsets_and_layers</a></th><td>Determines where riders get offset while riding</td></tr><tr><th><a href="datum/component/riding.html#proc/keycheck">keycheck</a></th><td>This proc is used to see if we have the appropriate key to drive this atom, if such a key is needed. Returns FALSE if we don't have what we need to drive.</td></tr><tr><th><a href="datum/component/riding.html#proc/on_entered_supermatter">on_entered_supermatter</a></th><td>When we touch a crystal, kill everything inside us</td></tr><tr><th><a href="datum/component/riding.html#proc/on_movement_type_trait_gain">on_movement_type_trait_gain</a></th><td>Called when our vehicle gains a movement trait, so we can apply it to the riders</td></tr><tr><th><a href="datum/component/riding.html#proc/on_movement_type_trait_loss">on_movement_type_trait_loss</a></th><td>Called when our vehicle loses a movement trait, so we can remove it from the riders</td></tr><tr><th><a href="datum/component/riding.html#proc/on_rider_try_pull">on_rider_try_pull</a></th><td>This proc is called when the rider attempts to grab the thing they're riding, preventing them from doing so.</td></tr><tr><th><a href="datum/component/riding.html#proc/ride_check">ride_check</a></th><td>Check to see if we have all of the necessary bodyparts and not-falling-over statuses we need to stay onboard.
If not and if consequences is TRUE, well, there'll be consequences.</td></tr><tr><th><a href="datum/component/riding.html#proc/riding_can_z_move">riding_can_z_move</a></th><td>Extra checks before buckled.can_z_move can be called in mob/living/can_z_move()</td></tr><tr><th><a href="datum/component/riding.html#proc/unequip_buckle_inhands">unequip_buckle_inhands</a></th><td>currently replicated from ridable because we need this behavior here too, see if we can deal with that</td></tr><tr><th><a href="datum/component/riding.html#proc/vehicle_bump">vehicle_bump</a></th><td>So we can check all occupants when we bump a door to see if anyone has access</td></tr><tr><th><a href="datum/component/riding.html#proc/vehicle_mob_buckle">vehicle_mob_buckle</a></th><td>This proc is called when a rider buckles, allowing for offsets to be set properly</td></tr><tr><th><a href="datum/component/riding.html#proc/vehicle_mob_unbuckle">vehicle_mob_unbuckle</a></th><td>This proc is called when a rider unbuckles, whether they chose to or not. If there's no more riders, this will be the riding component's death knell.</td></tr><tr><th><a href="datum/component/riding.html#proc/vehicle_moved">vehicle_moved</a></th><td>This is called after the ridden atom is successfully moved and is used to handle icon stuff</td></tr><tr><th><a href="datum/component/riding.html#proc/vehicle_turned">vehicle_turned</a></th><td>Turning is like moving</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/allowed_turf_typecache"><aside class="declaration">var </aside>allowed_turf_typecache <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L26"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 26"></a></h3><p>allow typecache for only certain turfs, forbid to allow all but those. allow only certain turfs will take precedence.</p><h3 id="var/can_force_unbuckle"><aside class="declaration">var </aside>can_force_unbuckle <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L34"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 34"></a></h3><p>can anyone other than the rider unbuckle the rider?</p><h3 id="var/forbid_turf_typecache"><aside class="declaration">var </aside>forbid_turf_typecache <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L28"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 28"></a></h3><p>allow typecache for only certain turfs, forbid to allow all but those. allow only certain turfs will take precedence.</p><h3 id="var/keytype"><aside class="declaration">var </aside>keytype <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L24"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 24"></a></h3><p>If the driver needs a certain item in hand (or inserted, for vehicles) to drive this. For vehicles, this must be duplicated on the actual vehicle object in their
<a href="obj/vehicle.html#var/key_type" title="/obj/vehicle">/obj/vehicle/var/key_type</a> variable because the vehicle objects still have a few special checks/functions of their own I'm not porting over to the riding component
quite yet. Make sure if you define it on the vehicle, you define it here too.</p><h3 id="var/message_cooldown"><aside class="declaration">var </aside>message_cooldown <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L42"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 42"></a></h3><p>For telling someone they can't drive</p><h3 id="var/override_allow_spacemove"><aside class="declaration">var </aside>override_allow_spacemove <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L32"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 32"></a></h3><p>We don't need roads where we're going if this is TRUE, allow normal movement in space tiles</p><h3 id="var/ride_check_flags"><aside class="declaration">var </aside>ride_check_flags <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L40"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 40"></a></h3><p>Ride check flags defined for the specific riding component types, so we know if we need arms, legs, or whatever.
Takes additional flags from the ridable element and the buckle proc (buckle_mob_flags) for riding cyborgs/humans in case we need to reserve arms</p><h3 id="var/rider_traits"><aside class="declaration">var </aside>rider_traits <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L30"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 30"></a></h3><p>additional traits to add to anyone riding this vehicle</p><h3 id="var/vehicle_move_cooldown"><aside class="declaration">var </aside>vehicle_move_cooldown <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L44"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 44"></a></h3><p>For telling someone they can't drive</p><h3 id="var/vehicle_move_delay"><aside class="declaration">var </aside>vehicle_move_delay <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L18"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 18"></a></h3><p>Tick delay between movements, lower = faster, higher = slower</p><h2 id="proc">Proc Details</h2><h3 id="proc/driver_move"><aside class="declaration">proc </aside>driver_move<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/movable_parent, /<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/user, direction)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L265"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 265"></a></aside></h3><p>Every time the driver tries to move, this is called to see if they can actually drive and move the vehicle (via relaymove)</p><h3 id="proc/get_parent_offsets_and_layers"><aside class="declaration">proc </aside>get_parent_offsets_and_layers<aside>() <span class="as"> as </span>/list <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L214"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 214"></a></aside></h3><p>Determines where the parent gets offset while riders are riding</p><h3 id="proc/get_rider_offsets_and_layers"><aside class="declaration">proc </aside>get_rider_offsets_and_layers<aside>(pass_index, /<a href="mob.html">mob</a>/offsetter) <span class="as"> as </span>/list <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L202"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 202"></a></aside></h3><p>Determines where riders get offset while riding</p>
<ul>
<li>pass_index: The index of the rider in the list of buckled mobs</li>
<li>mob/offsetter: The mob that is being offset</li>
</ul><h3 id="proc/keycheck"><aside class="declaration">proc </aside>keycheck<aside>(/<a href="mob.html">mob</a>/user)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L228"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 228"></a></aside></h3><p>This proc is used to see if we have the appropriate key to drive this atom, if such a key is needed. Returns FALSE if we don't have what we need to drive.</p>
<p>Still needs to be neatened up and spruced up with proper OOP, as a result of vehicles having their own key handling from other ridable atoms</p><h3 id="proc/on_entered_supermatter"><aside class="declaration">proc </aside>on_entered_supermatter<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/ridden, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/supermatter)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L324"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 324"></a></aside></h3><p>When we touch a crystal, kill everything inside us</p><h3 id="proc/on_movement_type_trait_gain"><aside class="declaration">proc </aside>on_movement_type_trait_gain<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/source, trait)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L303"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 303"></a></aside></h3><p>Called when our vehicle gains a movement trait, so we can apply it to the riders</p><h3 id="proc/on_movement_type_trait_loss"><aside class="declaration">proc </aside>on_movement_type_trait_loss<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/source, trait)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L310"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 310"></a></aside></h3><p>Called when our vehicle loses a movement trait, so we can remove it from the riders</p><h3 id="proc/on_rider_try_pull"><aside class="declaration">proc </aside>on_rider_try_pull<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/rider_pulling, /<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/target, force)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L113"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 113"></a></aside></h3><p>This proc is called when the rider attempts to grab the thing they're riding, preventing them from doing so.</p><h3 id="proc/ride_check"><aside class="declaration">proc </aside>ride_check<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/rider, consequences)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L144"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 144"></a></aside></h3><p>Check to see if we have all of the necessary bodyparts and not-falling-over statuses we need to stay onboard.
If not and if consequences is TRUE, well, there'll be consequences.</p><h3 id="proc/riding_can_z_move"><aside class="declaration">proc </aside>riding_can_z_move<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/movable_parent, direction, /<a href="turf.html">turf</a>/start, /<a href="turf.html">turf</a>/destination, z_move_flags, /<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/rider)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L298"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 298"></a></aside></h3><p>Extra checks before buckled.can_z_move can be called in mob/living/can_z_move()</p><h3 id="proc/unequip_buckle_inhands"><aside class="declaration">proc </aside>unequip_buckle_inhands<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/<a href="mob/living/carbon.html">carbon</a>/user)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L286"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 286"></a></aside></h3><p>currently replicated from ridable because we need this behavior here too, see if we can deal with that</p><h3 id="proc/vehicle_bump"><aside class="declaration">proc </aside>vehicle_bump<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/movable_parent, /<a href="obj.html">obj</a>/<a href="obj/machinery.html">machinery</a>/<a href="obj/machinery/door.html">door</a>/possible_bumped_door)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L271"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 271"></a></aside></h3><p>So we can check all occupants when we bump a door to see if anyone has access</p><h3 id="proc/vehicle_mob_buckle"><aside class="declaration">proc </aside>vehicle_mob_buckle<aside>(/<a href="datum.html">datum</a>/source, /<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/rider, force)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L95"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 95"></a></aside></h3><p>This proc is called when a rider buckles, allowing for offsets to be set properly</p><h3 id="proc/vehicle_mob_unbuckle"><aside class="declaration">proc </aside>vehicle_mob_unbuckle<aside>(/<a href="datum.html">datum</a>/source, /<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/rider, force)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L72"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 72"></a></aside></h3><p>This proc is called when a rider unbuckles, whether they chose to or not. If there's no more riders, this will be the riding component's death knell.</p><h3 id="proc/vehicle_moved"><aside class="declaration">proc </aside>vehicle_moved<aside>(/<a href="datum.html">datum</a>/source, oldloc, dir, forced)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L121"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 121"></a></aside></h3><p>This is called after the ridden atom is successfully moved and is used to handle icon stuff</p><h3 id="proc/vehicle_turned"><aside class="declaration">proc </aside>vehicle_turned<aside>(/<a href="datum.html">datum</a>/source, _old_dir, new_dir)  <a href="https://github.com/tgstation/tgstation/blob/c41b333c9bc46606d2c5d5b517f7836d5953fbfd/code/datums/components/riding/riding.dm#L135"><img src="git.png" width="16" height="16" title="code/datums/components/riding/riding.dm 135"></a></aside></h3><p>Turning is like moving</p></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/c41b333c9bc46606d2c5d5b517f7836d5953fbfd">c41b333</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>