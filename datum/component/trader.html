<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/component/trader - /tg/ Station 13</title></head><body><header><a href="index.html">/tg/ Station 13</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/component/trader.html#var">Var Details</a> - <a href="datum/component/trader.html#proc">Proc Details</a></header><main><h1>Trader NPC Component <aside>/<a href="datum.html">datum</a>/<a href="datum/component.html">component</a>/<a href="datum/component/trader.html">trader</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L32"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 32"></a></h1><p>Manages the barks and the stocks of the traders
Also manages the interactive radial menu</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/component/trader.html#var/products">products</a></th><td>Format; list(TYPEPATH = list(PRICE, QUANTITY))
Associated list of items the NPC sells with how much they cost and the quantity available before a restock
This list is filled by Initialize(), if you want to change the starting products, modify initial_products()</td></tr><tr><th><a href="datum/component/trader.html#var/radial_icons_cache">radial_icons_cache</a></th><td>Contains images of all radial icons</td></tr><tr><th><a href="datum/component/trader.html#var/trader_data">trader_data</a></th><td>Contains information of a specific trader</td></tr><tr><th><a href="datum/component/trader.html#var/wanted_items">wanted_items</a></th><td>A list of wanted items that the trader would wish to buy, each typepath has a assigned value, quantity and additional flavor text</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/component/trader.html#proc/apply_sell_price_mods">apply_sell_price_mods</a></th><td>Modifies the 'base' price of a item based on certain variables</td></tr><tr><th><a href="datum/component/trader.html#proc/buy_item">buy_item</a></th><td>Generates a radial of the items the NPC sells and lets the user try to buy one
Arguments:</td></tr><tr><th><a href="datum/component/trader.html#proc/can_trade">can_trade</a></th><td>Returns if the trader is conscious and its combat mode is disabled.</td></tr><tr><th><a href="datum/component/trader.html#proc/check_menu">check_menu</a></th><td>Checks if the customer is ok to use the radial</td></tr><tr><th><a href="datum/component/trader.html#proc/discuss">discuss</a></th><td>Talk about what items are being sold/wanted by the trader and in what quantity or lore</td></tr><tr><th><a href="datum/component/trader.html#proc/exchange_sold_items">exchange_sold_items</a></th><td>Handles modifying/deleting the items to ensure that a proper amount is converted into cash; put into its own proc to make the children of this not override a 30+ line sell_item()</td></tr><tr><th><a href="datum/component/trader.html#proc/generate_cash">generate_cash</a></th><td>Creates an item equal to the value set by the proc and puts it in the user's hands if possible
Arguments:</td></tr><tr><th><a href="datum/component/trader.html#proc/on_attack_hand">on_attack_hand</a></th><td>If our trader is alive, and the customer left clicks them with an empty hand without combat mode</td></tr><tr><th><a href="datum/component/trader.html#proc/open_npc_options">open_npc_options</a></th><td>Generates a radial of the initial radials of the NPC
Called via asynch, due to the sleep caused by show_radial_menu
Arguments:</td></tr><tr><th><a href="datum/component/trader.html#proc/renew_item_demands">renew_item_demands</a></th><td>Sets quantity of all wanted_items to initial(quanity);  this proc is currently called during initialize</td></tr><tr><th><a href="datum/component/trader.html#proc/restock_products">restock_products</a></th><td>Sets quantity of all products to initial(quanity); this proc is currently called during initialize</td></tr><tr><th><a href="datum/component/trader.html#proc/sell_item">sell_item</a></th><td>Checks if an item is in the list of wanted items and if it is after a Yes/No radial returns generate_cash with the value of the item for the NPC
Arguments:</td></tr><tr><th><a href="datum/component/trader.html#proc/spend_buyer_offhand_money">spend_buyer_offhand_money</a></th><td>Calculates the value of money in the hand of the buyer and spends it if it's sufficient</td></tr><tr><th><a href="datum/component/trader.html#proc/trader_buys_what">trader_buys_what</a></th><td>Displays to the customer what the trader is willing to buy and how much until a restock happens</td></tr><tr><th><a href="datum/component/trader.html#proc/trader_sells_what">trader_sells_what</a></th><td>Displays to the customer what the trader is selling and how much is in stock</td></tr><tr><th><a href="datum/component/trader.html#proc/try_sell">try_sell</a></th><td>Tries to call sell_item on one of the customer's held items, if fail gives a chat message</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/products"><aside class="declaration">var </aside>products <aside>– /list/<a href="obj.html">obj</a>/<a href="obj/item.html">item</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L40"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 40"></a></h3><p>Format; list(TYPEPATH = list(PRICE, QUANTITY))
Associated list of items the NPC sells with how much they cost and the quantity available before a restock
This list is filled by Initialize(), if you want to change the starting products, modify initial_products()</p><h3 id="var/radial_icons_cache"><aside class="declaration">var </aside>radial_icons_cache <aside>– /static/list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L62"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 62"></a></h3><p>Contains images of all radial icons</p><h3 id="var/trader_data"><aside class="declaration">var </aside>trader_data <aside>– /<a href="datum.html">datum</a>/<a href="datum/trader_data.html">trader_data</a></aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L65"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 65"></a></h3><p>Contains information of a specific trader</p><h3 id="var/wanted_items"><aside class="declaration">var </aside>wanted_items <aside>– /list</aside> <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L59"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 59"></a></h3><p>A list of wanted items that the trader would wish to buy, each typepath has a assigned value, quantity and additional flavor text</p>
<p>CHILDREN OF TYPEPATHS INCLUDED IN WANTED_ITEMS WILL BE TREATED AS THE PARENT IF NO ENTRY EXISTS FOR THE CHILDREN</p>
<p>As an additional note; if you include multiple children of a typepath; the typepath with the most children should be placed after all other typepaths
Bad; list(/obj/item/milk = list(100, 1, &quot;&quot;), /obj/item/milk/small = list(50, 2, &quot;&quot;))
Good; list(/obj/item/milk/small = list(50, 2, &quot;&quot;), /obj/item/milk = list(100, 1, &quot;&quot;))
This is mainly because sell_item() uses a istype(item_being_sold, item_in_entry) to determine what parent should the child be automatically considered as
If /obj/item/milk/small/spooky was being sold; /obj/item/milk/small would be the first to check against rather than /obj/item/milk</p>
<p>Format; list(TYPEPATH = list(PRICE, QUANTITY, ADDITIONAL_DESCRIPTION))
Associated list of items able to be sold to the NPC with the money given for them.
The price given should be the &quot;base&quot; price; any price manipulation based on variables should be done with apply_sell_price_mods()
ADDITIONAL_DESCRIPTION is any additional text added to explain how the variables of the item effect the price; if it's stack based, its final price depends how much is in the stack
EX; /obj/item/stack/sheet/mineral/diamond = list(500, INFINITY, &quot;, per 100 cm3 sheet of diamond&quot;)
This list is filled by Initialize(), if you want to change the starting wanted items, modify initial_wanteds()</p><h2 id="proc">Proc Details</h2><h3 id="proc/apply_sell_price_mods"><aside class="declaration">proc </aside>apply_sell_price_mods<aside>(/<a href="obj.html">obj</a>/<a href="obj/item.html">item</a>/selling, original_cost)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L323"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 323"></a></aside></h3><p>Modifies the 'base' price of a item based on certain variables</p>
<p>Arguments:</p>
<ul>
<li>Reference to the item; this is the item being sold</li>
<li>Original cost; the original cost of the item, to be manipulated depending on the variables of the item, one example is using item.amount if it's a stack</li>
</ul><h3 id="proc/buy_item"><aside class="declaration">proc </aside>buy_item<aside>(/<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L162"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 162"></a></aside></h3><p>Generates a radial of the items the NPC sells and lets the user try to buy one
Arguments:</p>
<ul>
<li>customer - (Mob REF) The mob trying to buy something</li>
</ul><h3 id="proc/can_trade"><aside class="declaration">proc </aside>can_trade<aside>(/<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L427"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 427"></a></aside></h3><p>Returns if the trader is conscious and its combat mode is disabled.</p><h3 id="proc/check_menu"><aside class="declaration">proc </aside>check_menu<aside>(/<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L150"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 150"></a></aside></h3><p>Checks if the customer is ok to use the radial</p>
<p>Checks if the customer is not a mob or is incapacitated or not adjacent to the source of the radial, in those cases returns FALSE, otherwise returns TRUE
Arguments:</p>
<ul>
<li>customer - (Mob REF) The mob checking the menu</li>
</ul><h3 id="proc/discuss"><aside class="declaration">proc </aside>discuss<aside>(/<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L359"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 359"></a></aside></h3><p>Talk about what items are being sold/wanted by the trader and in what quantity or lore</p><h3 id="proc/exchange_sold_items"><aside class="declaration">proc </aside>exchange_sold_items<aside>(/<a href="obj.html">obj</a>/<a href="obj/item.html">item</a>/selling, value_exchanged_for, original_typepath)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L337"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 337"></a></aside></h3><p>Handles modifying/deleting the items to ensure that a proper amount is converted into cash; put into its own proc to make the children of this not override a 30+ line sell_item()</p>
<p>Arguments:</p>
<ul>
<li>selling - (Item REF) this is the item being sold</li>
<li>value_exchanged_for - (Number) the &quot;value&quot;, useful for a scenario where you want to remove enough items equal to the value</li>
<li>original_typepath - (Typepath) For scenarios where a children of a parent is being sold but we want to modify the parent's product information</li>
</ul><h3 id="proc/generate_cash"><aside class="declaration">proc </aside>generate_cash<aside>(value, /<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L354"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 354"></a></aside></h3><p>Creates an item equal to the value set by the proc and puts it in the user's hands if possible
Arguments:</p>
<ul>
<li>value - A number; The amount of cash that will be on the holochip</li>
<li>customer - Reference to a mob; The mob we put the holochip in hands of</li>
</ul><h3 id="proc/on_attack_hand"><aside class="declaration">proc </aside>on_attack_hand<aside>(/<a href="atom.html">atom</a>/source, /<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/<a href="mob/living/carbon.html">carbon</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L104"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 104"></a></aside></h3><p>If our trader is alive, and the customer left clicks them with an empty hand without combat mode</p><h3 id="proc/open_npc_options"><aside class="declaration">proc </aside>open_npc_options<aside>(/<a href="mob.html">mob</a>/<a href="mob/living.html">living</a>/<a href="mob/living/carbon.html">carbon</a>/customer, /list/npc_options)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L131"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 131"></a></aside></h3><p>Generates a radial of the initial radials of the NPC
Called via asynch, due to the sleep caused by show_radial_menu
Arguments:</p>
<ul>
<li>customer - (Mob REF) The mob trying to buy something</li>
</ul><h3 id="proc/renew_item_demands"><aside class="declaration">proc </aside>renew_item_demands<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L423"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 423"></a></aside></h3><p>Sets quantity of all wanted_items to initial(quanity);  this proc is currently called during initialize</p><h3 id="proc/restock_products"><aside class="declaration">proc </aside>restock_products<aside>()  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L419"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 419"></a></aside></h3><p>Sets quantity of all products to initial(quanity); this proc is currently called during initialize</p><h3 id="proc/sell_item"><aside class="declaration">proc </aside>sell_item<aside>(/<a href="mob.html">mob</a>/customer, /<a href="obj.html">obj</a>/<a href="obj/item.html">item</a>/selling)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L259"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 259"></a></aside></h3><p>Checks if an item is in the list of wanted items and if it is after a Yes/No radial returns generate_cash with the value of the item for the NPC
Arguments:</p>
<ul>
<li>customer - (Mob REF) The mob trying to sell something</li>
<li>selling - (Item REF) The item being sold</li>
</ul><h3 id="proc/spend_buyer_offhand_money"><aside class="declaration">proc </aside>spend_buyer_offhand_money<aside>(/<a href="mob.html">mob</a>/customer, the_cost)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L224"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 224"></a></aside></h3><p>Calculates the value of money in the hand of the buyer and spends it if it's sufficient</p><h3 id="proc/trader_buys_what"><aside class="declaration">proc </aside>trader_buys_what<aside>(/<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L378"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 378"></a></aside></h3><p>Displays to the customer what the trader is willing to buy and how much until a restock happens</p><h3 id="proc/trader_sells_what"><aside class="declaration">proc </aside>trader_sells_what<aside>(/<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L400"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 400"></a></aside></h3><p>Displays to the customer what the trader is selling and how much is in stock</p><h3 id="proc/try_sell"><aside class="declaration">proc </aside>try_sell<aside>(/<a href="mob.html">mob</a>/customer)  <a href="https://github.com/tgstation/tgstation/blob/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f/code/datums/components/trader/trader.dm#L240"><img src="git.png" width="16" height="16" title="code/datums/components/trader/trader.dm 240"></a></aside></h3><p>Tries to call sell_item on one of the customer's held items, if fail gives a chat message</p>
<p>Gets both items in the customer's hands, and then tries to call sell_item on them, if both fail, he gives a chat message
Arguments:</p>
<ul>
<li>customer - (Mob REF) The mob trying to sell something</li>
</ul></main><footer>tgstation.dme <a href="https://github.com/tgstation/tgstation/tree/cd8d3cfc6452876b3929e640c2fd6fdbfee7f93f">cd8d3cf</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>